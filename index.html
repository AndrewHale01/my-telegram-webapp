<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telegram WebApp</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZN665FNYF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TZN665FNYF');
  </script>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif; /* Nicer font */
      padding-bottom: 60px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      position: relative;
    }
    .lang-btn {
      font-size: 1.5rem;
      cursor: pointer;
    }
    .lang-popup {
      display: none;
      position: absolute;
      top: 60px;
      left: 16px;
      background: #333;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      flex-direction: column;
      z-index: 10;
      width: 200px;
    }
    .lang-popup.active {
      display: flex;
    }
    .lang-option {
      background: none;
      color: #fff;
      border: none;
      padding: 8px 12px;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .lang-option:hover {
      background: #444;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #00bfae;
      cursor: pointer;
      object-fit: cover;
      background: #111;
      transition: box-shadow 0.2s;
    }
    .avatar-small:hover {
      box-shadow: 0 0 0 4px #00bfae55;
    }
    /* Updated Profile Popup positioning */
    #profilePopup {
      top: 60px;
      right: 16px; /* Moved to right */
      left: auto; /* Reset left */
      max-width: 360px;
    }
    .popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 0;
      background: #333;
      padding: 24px 20px 20px 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 10;
      flex-direction: column;
      min-width: 0px;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    .popup.active {
      display: flex;
    }

    .register-btn, .done-btn, .create-team-btn {
      background: #2196f3;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
      transition: background 0.2s;
      width: 100%;
      max-width: 220px;
    }
    .register-btn:hover, .done-btn:hover, .create-team-btn:hover {
      background: #1976d2;
    }

    .profile-form,
    .team-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 340px;
      margin-top: 8px;
      align-items: center;
    }
    .profile-form label,
    .team-form label {
      font-size: 0.95rem;
      color: #bbb;
      margin-bottom: 2px;
      align-self: flex-start;
    }
    .profile-form input,
    .team-form input[type="text"],
    .team-form input[type="file"] {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
    .profile-form input[readonly] {
      background: #222;
      color: #aaa;
      border: 1px solid #444;
    }

    .player-profile {
      width: 100%;
      max-width: 220px;
      background: #222;
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 1rem;
      display: none;
      color: #fff;
    }
    .player-profile-title {
      margin-bottom: 8px;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.05rem;
    }
    .player-profile-row {
      margin-bottom: 4px;
      word-break: break-word;
    }

    .success-message, .team-success-message {
      color: #00bfae;
      font-size: 1rem;
      margin: 10px 0 0 0;
      text-align: center;
    }

    .team-avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #00bfae;
      margin-bottom: 8px;
      background: #111;
      display: none;
    }

    .team-player-block {
      background: #292929;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .team-player-title {
      color: #00bfae;
      font-weight: bold;
      margin-bottom: 4px;
      font-size: 1rem;
    }

    .notification-btn {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      position: relative;
      margin-left: 8px;
      color: #fff;
    }
    .notification-badge {
      position: absolute;
      top: 2px;
      right: 10px;
      background: #e53935;
      color: #fff;
      border-radius: 50%;
      font-size: 0.85rem;
      min-width: 20px;
      min-height: 20px;
      padding: 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid #222;
      box-sizing: border-box;
      z-index: 2;
    }

    #adminPopup {
      display: none;
      position: fixed;
      top: 90px;
      right: 20px;
      background: #1e1e1e;
      border: 2px solid #00bfae;
      border-radius: 16px;
      padding: 20px 24px;
      z-index: 999;
      width: 320px;
      box-shadow: 0 0 20px rgba(0, 191, 174, 0.3);
      font-family: 'Segoe UI', sans-serif;
      animation: fadeIn 0.2s ease-in-out;
    }

    #adminPopup.active {
      display: block;
    }

    #adminPopup h2 {
      color: #00bfae;
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 20px;
      text-align: center;
    }

    #adminPopup button {
      padding: 10px 16px;
      font-size: 15px;
      background-color: #2b2b2b;
      color: #eee;
      border: 1px solid #00bfae;
      border-radius: 10px;
      margin-bottom: 10px;
      width: 100%;
      transition: background 0.2s;
    }

    #adminPopup button:hover {
      background-color: #00bfae;
      color: #111;
    }

    #closeAdminModal {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      color: #aaa;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    #adminMenuBtn {
      font-size: 28px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95);}
      to { opacity: 1; transform: scale(1);}
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active, .nav-item:hover {
      color: #00bfae;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
    .news-section,
    .disciplines-section,
    .tournaments-section {
      margin-top: 24px;
      padding: 0 16px;
    }

    .news-title,
    .disciplines-title,
    .tournaments-title {
      margin-left: 4px;
      margin-bottom: 8px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #00bfae;
    }
    .news-list,
    .disciplines-list,
    .tournament-list {
      display: flex;
      overflow-x: auto;
      gap: 16px;
      padding: 12px 4px;
      scroll-snap-type: x mandatory;
    }

    .news-card,
    .tournament-card,
    .discipline-card {
      flex: 0 0 auto;
      width: 280px;
      background: #292929;
      border: 2px solid #00bfae88;
      border-radius: 12px;
      padding: 16px;
      scroll-snap-align: start;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .news-card:hover,
    .tournament-card:hover,
    .discipline-card:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 10px rgba(0, 191, 174, 0.25);
    }

    .news-card h4,
    .tournament-card h4 {
      margin-top: 0;
      color: #00bfae;
      font-size: 1.1rem;
    }

    .news-card p,
    .tournament-card p {
      font-size: 0.95rem;
      color: #ddd;
    }

    .discipline-img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .discipline-name {
      font-weight: bold;
      text-align: center;
      font-size: 1rem;
      color: #fff;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item:hover {
      color: #00bfae;
    }
    .section {
      padding: 24px 16px;
      display: none;
    }
    .section.active {
      display: block;
    }
    /* Updated Notification Popup positioning */
    #notificationPopup {
      right: 16px; /* Adjusted to align with other right-aligned elements */
      min-width: 280px;
    }

    /* New styles for consistent pages */
    .section h2 {
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 1.5rem; /* Larger heading */
      font-weight: bold;
      color: #00bfae; /* Consistent highlight color */
      text-align: center;
    }
    .section p {
      font-size: 1rem;
      color: #ddd;
      line-height: 1.5;
      margin-bottom: 16px;
    }
    .section details {
      background: #292929;
      border: 2px solid #00bfae88;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      color: #fff;
      font-size: 1rem;
    }
    .section summary {
      font-weight: bold;
      color: #00bfae;
      cursor: pointer;
      padding: 4px 0;
    }
    .section details p {
      padding-top: 10px;
      margin-bottom: 0;
      color: #ccc;
      font-size: 1rem; /* Bigger font for rules */
      font-family: 'Segoe UI', Arial, sans-serif; /* Nicer font for rules */
    }

    /* Styles for Awards and Tournament Details */
    .award-card {
        background: #292929;
        border: 2px solid #00bfae88;
        border-radius: 12px;
        padding: 12px; /* Smaller padding for a more compact card */
        margin-bottom: 12px;
        display: flex; /* Make it horizontal */
        align-items: center; /* Vertically align items */
        gap: 12px; /* Space between icon and text */
        cursor: pointer; /* Indicate it's clickable */
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .award-card:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 10px rgba(0, 191, 174, 0.25);
    }

    .award-content-wrapper {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%; /* Take full width of card */
    }

    .award-card-icon {
        font-size: 2.2rem; /* Size for emoji icon */
        line-height: 1;
        flex-shrink: 0; /* Prevent icon from shrinking */
    }

    .award-card-img {
        width: 48px; /* Size for image icon */
        height: 48px;
        object-fit: cover;
        border-radius: 8px; /* Slightly rounded corners for images */
        flex-shrink: 0;
    }

    .award-text-content {
        flex-grow: 1; /* Allow text content to take available space */
    }

    .award-text-content h4 {
        margin: 0;
        color: #00bfae;
        font-size: 1.1rem;
        white-space: nowrap; /* Prevent title from wrapping */
        overflow: hidden; /* Hide overflow */
        text-overflow: ellipsis; /* Add ellipsis if too long */
    }

    .tournament-name-on-card {
        margin: 4px 0 0;
        font-size: 0.9rem;
        color: #ddd;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .btn-primary {
        background: #00bfae;
        color: #fff;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        transition: background 0.2s ease-in-out;
        width: 100%;
        max-width: 300px;
        display: block; /* Make it a block element to center with margin auto */
        margin-left: auto;
        margin-right: auto;
        text-align: center;
    }

    .btn-primary:hover {
        background: #008f82;
    }

    .back-btn {
        background: #333;
        color: #eee;
        border: 1px solid #555;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        margin-top: 20px;
        margin-bottom: 10px;
        transition: background 0.2s ease-in-out;
    }

    .back-btn:hover {
        background: #444;
    }

    .ranking-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        color: #fff;
    }

    .ranking-table th,
    .ranking-table td {
        padding: 10px;
        border: 1px solid #333;
        text-align: left;
    }

    .ranking-table th {
        background-color: #00bfae;
        color: #111;
        font-weight: bold;
    }

    .ranking-table tbody tr:nth-child(even) {
        background-color: #292929;
    }

    .ranking-table tbody tr:nth-child(odd) {
        background-color: #222;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="lang-btn" id="langBtn">🌐</div>
    <div id="langPopup" class="lang-popup popup">
      <button class="lang-option" data-lang="uk">🇺🇦 Українська</button>
      <button class="lang-option" data-lang="en">🇬🇧 English</button>
      <button class="lang-option" data-lang="ru">🇷🇺 Русский</button>
      <button class="lang-option" data-lang="pl">🇵🇱 Polski</button>
    </div>
    <img id="avatar" class="avatar-small" src="avatar.jpg" alt="Avatar">
    <button id="notificationBtn" class="notification-btn" title="Сповіщення">
      🔔
      <span id="notificationBadge" class="notification-badge" style="display:none;">0</span>
    </button>
    <div class="admin-menu" id="adminMenuBtn" title="Адмін-меню">🛡️</div>
    <div id="adminPopup" class="adminPopup popup">
      <h2 id="adminMenuTitle" style="color:#00bfae; margin-top:0;">Адмін-меню</h2>
      <div style="display:flex; flex-direction:column; gap:12px;">
        <button id="banUserBtn" data-i18n="ban_user">🚫 Заблокувати користувача</button>
        <button id="unbanUserBtn" data-i18n="unban_user">✅ Розблокувати користувача</button>
        <button id="givePrizeBtn" data-i18n="give_prize">🏆 Видати приз</button>
        <button id="disqualifyTeamBtn" data-i18n="disqualify_team">❌ Дискваліфікувати команду</button>
        <button id="editBracketBtn" data-i18n="edit_bracket">🗂️ Модерувати сітку</button>
      </div>
    </div>

    <div id="profilePopup" class="popup">
      <button class="register-btn" id="registerBtn" data-i18n="register">Зареєструватись</button>
    </div>
    <form class="profile-form" id="profileForm" style="display:none;">
      <label for="standoffNick" data-i18n="standoff_nick">Нік в Standoff</label>
      <input type="text" id="standoffNick" name="standoffNick" required maxlength="32" autocomplete="off">
      <label for="standoffId" data-i18n="standoff_id">ID в Standoff</label>
      <input type="text" id="standoffId" name="standoffId" required maxlength="32" autocomplete="off">
      <label for="tgUser" data-i18n="tg_user">Telegram</label>
      <input type="text" id="tgUser" name="tgUser" readonly>
      <button type="submit" class="done-btn" id="doneBtn" data-i18n="done">Готово</button>
    </form>

    <div class="player-profile" id="playerProfile">
      <div class="player-profile-title" data-i18n="profile">Профіль гравця</div>
      <div class="player-profile-row">
        <span data-i18n="standoff_nick">Нік в Standoff</span>: <span id="profileNick"></span>
      </div>
      <div class="player-profile-row">
        <span data-i18n="standoff_id">ID в Standoff</span>: <span id="profileId"></span>
      </div>
      <div class="player-profile-row">
        <span data-i18n="tg_user">Telegram</span>: <span id="profileTg"></span>
      </div>
    </div>

    <button class="create-team-btn" id="createTeamBtn" style="display:none;" data-i18n="create_team">Створити команду</button>
    <div class="success-message" id="successMsg" style="display:none;" data-i18n="profile_saved">Профіль збережено!</div>

    <form class="team-form" id="teamForm" style="display:none;">
      <label for="teamAvatar" data-i18n="team_avatar">Аватарка команди</label>
      <input type="file" id="teamAvatar" accept="image/*">
      <img id="teamAvatarPreview" class="team-avatar-preview" src="#" alt="Team Avatar">

      <label for="teamTag" data-i18n="team_tag">Тег команди</label>
      <input type="text" id="teamTag" maxlength="12" required data-i18n-placeholder="team_tag_ph">

      <label for="teamName" data-i18n="team_name">Назва команди</label>
      <input type="text" id="teamName" maxlength="32" required data-i18n-placeholder="team_name_ph">

      <div class="team-player-block">
        <div class="team-player-title" data-i18n="main_player1">Гравець 1 (капітан)</div>
        <input type="text" id="main1Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="main1Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="main1Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="main_player2">Гравець 2 (основний)</div>
        <input type="text" id="main2Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="main2Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="main2Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="main_player3">Гравець 3 (основний)</div>
        <input type="text" id="main3Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="main3Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="main3Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="main_player4">Гравець 4 (основний)</div>
        <input type="text" id="main4Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="main4Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="main4Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="main_player5">Гравець 5 (основний)</div>
        <input type="text" id="main5Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="main5Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="main5Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="spare_player1">Гравець 6 (запасний)</div>
        <input type="text" id="spare1Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="spare1Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="spare1Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>
      <div class="team-player-block">
        <div class="team-player-title" data-i18n="spare_player2">Гравець 7 (запасний)</div>
        <input type="text" id="spare2Id" placeholder="ID в Standoff 2" required data-i18n-placeholder="player_id_ph">
        <input type="text" id="spare2Nick" placeholder="Нікнейм" required data-i18n-placeholder="player_nick_ph">
        <input type="text" id="spare2Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
      </div>

      <button type="submit" class="done-btn" id="teamDoneBtn" data-i18n="team_done">Готово</button>
    </form>

    <div class="team-success-message" id="teamSuccessMsg" style="display:none;" data-i18n="team_created">Команду створено!</div>
  </div>

  <div id="notificationPopup" class="popup">
    <div style="font-weight:bold; color:#00bfae; margin-bottom:8px;" id="notificationTitle">Сповіщення</div>
    <div id="notificationList" style="width:100%;"></div>
    <button id="clearNotificationsBtn" class="done-btn" style="margin-top:10px;">Очистити</button>
  </div>

  <div id="homeSection" class="section active">
    <div class="main-section" id="mainSection">
      <div class="news-section">
        <div class="news-title" data-i18n="news">Новини</div>
        <div class="news-list" id="newsList">
          <div class="news-card">
            <h4 data-i18n="news1title">🔔 Оновлення</h4>
            <p data-i18n="news1desc">Ми додали підтримку англійської мови та оновили інтерфейс.</p>
          </div>
          <div class="news-card">
            <h4 data-i18n="news2title">🏆 Турніри оновлено</h4>
            <p data-i18n="news2desc">Тепер усі турніри доступні на окремій сторінці.</p>
          </div>
        </div>
      </div>

      <div class="disciplines-section">
        <div class="disciplines-title" data-i18n="disciplines">Дисципліни</div>
        <div class="disciplines-list">
          <div class="discipline-card">
            <img src="Standoff2.jpg" alt="Standoff 2" class="discipline-img">
            <div class="discipline-name">Standoff 2</div>
          </div>
        </div>
      </div>

      <div class="tournaments-section">
        <div class="tournaments-title" data-i18n="tournaments">Турніри</div>
        <div class="tournament-list" id="tournamentList">
          <div class="tournament-card">
            <h4>RFORZ Grad Prix</h4>
            <p data-i18n="tournament1desc">Старт: 1 липня. Призовий фонд: 5000₴</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="rulesSection" class="section">
    <h2 data-i18n="rules_main_title">Правила турніру</h2>
    <details>
      <summary data-i18n="rules_1v1_summary">Турніри 1х1</summary>
      <p data-i18n="rules_1v1_text">• Гравці грають один проти одного.<br>
         • Раунди проходять до 3 перемог.<br>
         • Перемагає той, хто перший виграє 3 раунди.
      </p>
    </details>
    <details>
      <summary data-i18n="rules_2v2_summary">Турніри 2х2</summary>
      <p data-i18n="rules_2v2_text">• Команди по 2 гравці.<br>
         • Успіх залежить від координації та злагодженої гри.<br>
         • Перші до 5 перемог — проходять далі.
      </p>
    </details>
    <details>
        <summary data-i18n="rules_5v5_standoff_summary">Правила Турніру по Standoff 2 (5 на 5)</summary>
        <div>
            <p data-i18n="rules_5v5_standoff_1_title">1. Общие положения:</p>
            <p data-i18n="rules_5v5_standoff_1_1">• Турнир проводится по дисциплине Standoff 2.</p>
            <p data-i18n="rules_5v5_standoff_1_2">• Формат матчей: 5 на 5.</p>
            <p data-i18n="rules_5v5_standoff_1_3">• Все участники обязаны соблюдать правила честной игры и проявлять уважение к другим игрокам и судьям турнира.</p>
            <p data-i18n="rules_5v5_standoff_2_title">2. Участие и регистрация:</p>
            <p data-i18n="rules_5v5_standoff_2_1">• Команда состоит из 5 основных игроков и до 2 запасных.</p>
            <p data-i18n="rules_5v5_standoff_2_2">• Рагионы: Польша, Нидерланды, Франция.</p>
            <p data-i18n="rules_5v5_standoff_2_3">• Максимально допустимый пинг — 100 мс. Игроки с превышением этого значения могут быть отстранены от участия.</p>
            <p data-i18n="rules_5v5_standoff_2_4">• Регистрация проходит через указанную организаторами платформу или форму.</p>
            <p data-i18n="rules_5v5_standoff_3_title">3. Технические требования:</p>
            <p data-i18n="rules_5v5_standoff_3_1">• Игра проводится только на мобильных устройствах. Использование эмуляторов запрещено.</p>
            <p data-i18n="rules_5v5_standoff_3_2">• Проверка пинга производится перед каждым матчем.</p>
            <p data-i18n="rules_5v5_standoff_3_3">• Использование VPN, прокси и любых средств для изменения региона/пинга строго запрещено.</p>
            <p data-i18n="rules_5v5_standoff_4_title">4. Формат турнира:</p>
            <p data-i18n="rules_5v5_standoff_4_1">• Матчи группового этапа проходять у форматі Best of 2 (BO2). Полуфинал — Best of 3 (BO3).</p>
            <p data-i18n="rules_5v5_standoff_4_2">• Финал – Best of 5 (BO5).</p>
            <p data-i18n="rules_5v5_standoff_4_3">• Победа присуждается команде, первой выигравшей 13 раундов.</p>
            <p data-i18n="rules_5v5_standoff_4_4">• Карты выбираются методом “ban/pick” (отказ/выбор).</p>
            <p data-i18n="rules_5v5_standoff_4_5">• Перерывы между половинами — 1 минута. Переключение сторон происходит после 12 раундов.</p>
            <p data-i18n="rules_5v5_standoff_5_title">5. Поведение игроков:</p>
            <p data-i18n="rules_5v5_standoff_5_1">• Запрещено использование стороннего ПО, читов и багов.</p>
            <p data-i18n="rules_5v5_standoff_5_2">• Оскорбления, токсичное поведение и провокации запрещены.</p>
            <p data-i18n="rules_5v5_standoff_5_3">• Все спорные ситуации решаются судьёй матча. Решения администрации окончательны.</p>
            <p data-i18n="rules_5v5_standoff_6_title">6. Прерывание матча:</p>
            <p data-i18n="rules_5v5_standoff_6_1">• При вылете игрока матч продолжается, если ситуация не критична.</p>
            <p data-i18n="rules_5v5_standoff_6_2">• В случае технических проблем команда обязана уведомить администратора в течение 2 минут.</p>
            <p data-i18n="rules_5v5_standoff_6_3">• Допускается 1 техническая пауза на матч продолжительностью до 5 минут (по согласованию с судьёй).</p>
            <p data-i18n="rules_5v5_standoff_7_title">7. Санкции:</p>
            <p data-i18n="rules_5v5_standoff_7_1">• 1-е нарушение правил — предупреждение.</p>
            <p data-i18n="rules_5v5_standoff_7_2">• 2-е — дисквалификация игрока или всей команды в зависимости от тяжести нарушения.</p>
            <p data-i18n="rules_5v5_standoff_7_3">• Повторяющиеся нарушения — немедленное снятие с турнира.</p>
            <p data-i18n="rules_5v5_standoff_8_title">8. Призы и награды:</p>
            <p data-i18n="rules_5v5_standoff_8_1">• Призовой фонд та розподіл місць оголошуються перед початком турніру.</p>
            <p data-i18n="rules_5v5_standoff_8_2">• Призи розподіляються всередині команди самостійно або порівну (за замовчуванням).</p>
        </div>
    </details>
  </div>
  <div id="awardsSection" class="section">
    <h2 data-i18n="awards_title">Нагороди</h2>
    <p data-i18n="awards_text">Усі учасники фіналу отримують спеціальні бонуси. Переможці — призи та сертифікати.</p>
    <div id="myAwardsList">
      </div>
    </div>

  <div id="tournamentDetailsSection" class="section">
    <button id="backToAwardsBtn" class="back-btn" data-i18n="back_to_awards">← До моїх нагород</button>
    <h2 id="tournamentDetailsTitle" data-i18n="tournament_details_title_dynamic">Деталі Турніру та Рейтинг</h2>
    <div id="rankingTableContainer">
        </div>
  </div>

  <div id="supportSection" class="section">
    <h2 data-i18n="support_title">Підтримка</h2>
    <p data-i18n="support_text">Напиши @admin у Telegram, якщо виникли проблеми.</p>
  </div>

  <div class="bottom-nav">
    <div class="nav-item" data-target="homeSection"><span>🏠</span><p data-i18n="home">Головна</p></div>
    <div class="nav-item" data-target="rulesSection"><span>📄</span><p data-i18n="rules">Правила</p></div>
    <div class="nav-item" data-target="awardsSection"><span>🏆</span><p data-i18n="awards">Нагороди</p></div>
    <div class="nav-item" data-target="supportSection"><span>🤖</span><p data-i18n="support">Підтримка</p></div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // Constants for admin IDs
    const ADMIN_IDS = [5806282517]; // Add your admin IDs here

    // Translations object
    const translations = {
      uk: {
        home: "Головна",
        rules: "Правила",
        awards: "Нагороди",
        support: "Підтримка",
        news: "Новини",
        news1title: "🔔 Оновлення",
        news1desc: "Ми додали підтримку англійської мови та оновили інтерфейс.",
        news2title: "🏆 Турніри оновлено",
        news2desc: "Тепер усі турніри доступні на окремій сторінці.",
        disciplines: "Дисципліни",
        tournaments: "Турніри",
        tournament1desc: "Старт: 1 липня. Призовий фонд: 5000₴",
        register: "Зареєструватись",
        standoff_nick: "Нік в Standoff",
        standoff_id: "ID в Standoff",
        tg_user: "Telegram",
        done: "Готово",
        profile: "Профіль гравця",
        create_team: "Створити команду",
        profile_saved: "Профіль збережено!",
        team_avatar: "Аватарка команди",
        team_tag: "Тег команди",
        team_tag_ph: "Введіть тег",
        team_name: "Назва команди",
        team_name_ph: "Введіть назву",
        main_player1: "Гравець 1 (капітан)",
        main_player2: "Гравець 2 (основний)",
        main_player3: "Гравець 3 (основний)",
        main_player4: "Гравець 4 (основний)",
        main_player5: "Гравець 5 (основний)",
        spare_player1: "Гравець 6 (запасний)",
        spare_player2: "Гравець 7 (запасний)",
        player_id_ph: "ID в Standoff 2",
        player_nick_ph: "Нікнейм",
        player_tg_ph: "Telegram",
        team_done: "Готово",
        team_created: "Команду створено!",
        awards_title: "Нагороди",
        awards_text: "Усі учасники фіналу отримують спеціальні бонуси. Переможці — призи та сертифікати.",
        ban_user: "🚫 Заблокувати користувача",
        unban_user: "✅ Розблокувати користувача",
        give_prize: "🏆 Видати приз",
        disqualify_team: "❌ Дискваліфікувати команду",
        edit_bracket: "🗂️ Модерувати сітку",
        admin_menu: "Адмін-меню",
        admin_access_denied: "Ви не маєте доступу до адмін-меню.",
        no_notifications: "У вас немає сповіщень.",
        rules_main_title: "Правила турніру",
        rules_1v1_summary: "Турніри 1х1",
        rules_1v1_text: "• Гравці грають один проти одного.<br>• Раунди проходять до 3 перемог.<br>• Перемагає той, хто перший виграє 3 раунди.",
        rules_2v2_summary: "Турніри 2х2",
        rules_2v2_text: "• Команди по 2 гравці.<br>• Успіх залежить від координації та злагодженої гри.<br>• Перші до 5 перемог — проходять далі.",
        rules_5v5_standoff_summary: "Правила Турніру по Standoff 2 (5 на 5)",
        rules_5v5_standoff_1_title: "1. Загальні положення:",
        rules_5v5_standoff_1_1: "• Турнір проводиться за дисципліною Standoff 2.",
        rules_5v5_standoff_1_2: "• Формат матчів: 5 на 5.",
        rules_5v5_standoff_1_3: "• Всі учасники зобов'язані дотримуватися правил чесної гри та виявляти повагу до інших гравців та суддів турніру.",
        rules_5v5_standoff_2_title: "2. Участь та реєстрація:",
        rules_5v5_standoff_2_1: "• Команда складається з 5 основних гравців і до 2 запасних.",
        rules_5v5_standoff_2_2: "• Регіони: Польща, Нідерланди, Франція.",
        rules_5v5_standoff_2_3: "• Максимально допустимий пінг — 100 мс. Гравці з перевищенням цього значення можуть бути відсторонені від участі.",
        rules_5v5_standoff_2_4: "• Реєстрація проходить через зазначену організаторами платформу або форму.",
        rules_5v5_standoff_3_title: "3. Технічні вимоги:",
        rules_5v5_standoff_3_1: "• Гра проводиться тільки на мобільних пристроях. Використання емуляторів заборонено.",
        rules_5v5_standoff_3_2: "• Перевірка пінгу проводиться перед кожним матчем.",
        rules_5v5_standoff_3_3: "• Використання VPN, проксі та будь-яких засобів для зміни регіону/пінгу суворо заборонено.",
        rules_5v5_standoff_4_title: "4. Формат турніру:",
        rules_5v5_standoff_4_1: "• Матчі групового етапу проходять у форматі Best of 2 (BO2). Півфінал — Best of 3 (BO3).",
        rules_5v5_standoff_4_2: "• Фінал – Best of 5 (BO5).",
        rules_5v5_standoff_4_3: "• Перемога присуджується команді, що першою виграла 13 раундів.",
        rules_5v5_standoff_4_4: "• Карти вибираються методом “ban/pick” (відмова/вибір).",
        rules_5v5_standoff_4_5: "• Перерви між половинами — 1 хвилина. Перемикання сторін відбувається після 12 раундів.",
        rules_5v5_standoff_5_title: "5. Поведінка гравців:",
        rules_5v5_standoff_5_1: "• Заборонено використання стороннього ПО, читів та багів.",
        rules_5v5_standoff_5_2: "• Образи, токсична поведінка та провокації заборонені.",
        rules_5v5_standoff_5_3: "• Всі спірні ситуації вирішуються суддею матчу. Рішення адміністрації остаточні.",
        rules_5v5_standoff_6_title: "6. Переривання матчу:",
        rules_5v5_standoff_6_1: "• При вильоті гравця матч продовжується, якщо ситуація не критична.",
        rules_5v5_standoff_6_2: "• У випадку технічних проблем команда зобов'язана повідомити адміністратора протягом 2 хвилин.",
        rules_5v5_standoff_6_3: "• Допускається 1 технічна пауза на матч тривалістю до 5 хвилин (за погодженням з суддею).",
        rules_5v5_standoff_7_title: "7. Санкції:",
        rules_5v5_standoff_7_1: "• 1-е порушення правил — попередження.",
        rules_5v5_standoff_7_2: "• 2-е — дискваліфікація гравця або всієї команди в залежності від тяжкості порушення.",
        rules_5v5_standoff_7_3: "• Повторювані порушення — негайне зняття з турніру.",
        rules_5v5_standoff_8_title: "8. Призи та нагороди:",
        rules_5v5_standoff_8_1: "• Призовий фонд та розподіл місць оголошуються перед початком турніру.",
        rules_5v5_standoff_8_2: "• Призи розподіляються всередині команди самостійно або порівну (за замовчуванням).",
        support_title: "Підтримка",
        support_text: "Напиши @admin у Telegram, якщо виникли проблеми.",
        view_tournament_details: "Дивитися деталі турніру",
        back_to_awards: "← До моїх нагород",
        tournament_details_title_dynamic: "Деталі Турніру та Рейтинг",
        no_awards_yet: "Наразі у вас немає нагород.",
        prize_award: "Приз",
        bonus_award: "Бонус",
        certificate_award: "Сертифікат"
      },
      en: {
        home: "Home",
        rules: "Rules",
        awards: "Awards",
        support: "Support",
        news: "News",
        news1title: "🔔 Update",
        news1desc: "We have added English language support and updated the interface.",
        news2title: "🏆 Tournaments Updated",
        news2desc: "All tournaments are now available on a separate page.",
        disciplines: "Disciplines",
        tournaments: "Tournaments",
        tournament1desc: "Start: July 1. Prize pool: 5000₴",
        register: "Register",
        standoff_nick: "Standoff Nickname",
        standoff_id: "Standoff ID",
        tg_user: "Telegram",
        done: "Done",
        profile: "Player Profile",
        create_team: "Create Team",
        profile_saved: "Profile saved!",
        team_avatar: "Team Avatar",
        team_tag: "Team Tag",
        team_tag_ph: "Enter tag",
        team_name: "Team Name",
        team_name_ph: "Enter name",
        main_player1: "Player 1 (Captain)",
        main_player2: "Player 2 (Main)",
        main_player3: "Player 3 (Main)",
        main_player4: "Player 4 (Main)",
        main_player5: "Player 5 (Main)",
        spare_player1: "Player 6 (Substitute)",
        spare_player2: "Player 7 (Substitute)",
        player_id_ph: "Standoff 2 ID",
        player_nick_ph: "Nickname",
        player_tg_ph: "Telegram",
        team_done: "Done",
        team_created: "Team created!",
        awards_title: "Awards",
        awards_text: "All finalists receive special bonuses. Winners receive prizes and certificates.",
        ban_user: "🚫 Ban User",
        unban_user: "✅ Unban User",
        give_prize: "🏆 Give Prize",
        disqualify_team: "❌ Disqualify Team",
        edit_bracket: "🗂️ Moderate Bracket",
        admin_menu: "Admin Menu",
        admin_access_denied: "You do not have access to the admin menu.",
        no_notifications: "You have no notifications.",
        rules_main_title: "Tournament Rules",
        rules_1v1_summary: "1v1 Tournaments",
        rules_1v1_text: "• Players play against each other.\n• Rounds are played to 3 wins.\n• The first to win 3 rounds wins.",
        rules_2v2_summary: "2v2 Tournaments",
        rules_2v2_text: "• Teams of 2 players.\n• Success depends on coordination and teamwork.\n• First to 5 wins — proceeds.",
        rules_5v5_standoff_summary: "Standoff 2 Tournament Rules (5v5)",
        rules_5v5_standoff_1_title: "1. General Provisions:",
        rules_5v5_standoff_1_1: "• The tournament is held in the discipline of Standoff 2.",
        rules_5v5_standoff_1_2: "• Match format: 5 vs 5.",
        rules_5v5_standoff_1_3: "• All participants must comply with fair play rules and show respect to other players and tournament judges.",
        rules_5v5_standoff_2_title: "2. Participation and Registration:",
        rules_5v5_standoff_2_1: "• A team consists of 5 main players and up to 2 substitutes.",
        rules_5v5_standoff_2_2: "• Regions: Poland, Netherlands, France.",
        rules_5v5_standoff_2_3: "• Maximum allowable ping is 100 ms. Players exceeding this value may be suspended from participation.",
        rules_5v5_standoff_2_4: "• Registration is done through the platform or form specified by the organizers.",
        rules_5v5_standoff_3_title: "3. Technical Requirements:",
        rules_5v5_standoff_3_1: "• The game is played only on mobile devices. Emulators are prohibited.",
        rules_5v5_standoff_3_2: "• Ping check is performed before each match.",
        rules_5v5_standoff_3_3: "• The use of VPN, proxies, and any means to change region/ping is strictly prohibited.",
        rules_5v5_standoff_4_title: "4. Tournament Format:",
        rules_5v5_standoff_4_1: "• Group stage matches are played in Best of 2 (BO2) format. Semifinals — Best of 3 (BO3).",
        rules_5v5_standoff_4_2: "• Final – Best of 5 (BO5).",
        rules_5v5_standoff_4_3: "• Victory is awarded to the team that first wins 13 rounds.",
        rules_5v5_standoff_4_4: "• Maps are selected by “ban/pick” method.",
        rules_5v5_standoff_4_5: "• Breaks between halves — 1 minute. Side switching occurs after 12 rounds.",
        rules_5v5_standoff_5_title: "5. Player Behavior:",
        rules_5v5_standoff_5_1: "• Use of third-party software, cheats, and bugs is prohibited.",
        rules_5v5_standoff_5_2: "• Insults, toxic behavior, and provocations are prohibited.",
        rules_5v5_standoff_5_3: "• All controversial situations are resolved by the match referee. Administrative decisions are final.",
        rules_5v5_standoff_6_title: "6. Match Interruption:",
        rules_5v5_standoff_6_1: "• If a player disconnects, the match continues if the situation is not critical.",
        rules_5v5_standoff_6_2: "• In case of technical problems, the team must notify the administrator within 2 minutes.",
        rules_5v5_standoff_6_3: "• One technical pause per match is allowed for up to 5 minutes (by agreement with the referee).",
        rules_5v5_standoff_7_title: "7. Penalties:",
        rules_5v5_standoff_7_1: "• 1st violation of rules — warning.",
        rules_5v5_standoff_7_2: "• 2nd — disqualification of the player or the entire team depending on the severity of the violation.",
        rules_5v5_standoff_7_3: "• Repeated violations — immediate removal from the tournament.",
        rules_5v5_standoff_8_title: "8. Prizes and Rewards:",
        rules_5v5_standoff_8_1: "• Prize pool and placement distribution are announced before the start of the tournament.",
        rules_5v5_standoff_8_2: "• Prizes are distributed within the team independently or equally (by default).",
        support_title: "Support",
        support_text: "Contact @admin on Telegram if you have any issues.",
        view_tournament_details: "View Tournament Details",
        back_to_awards: "← Back to My Awards",
        tournament_details_title_dynamic: "Tournament Details & Ranking",
        no_awards_yet: "You have no awards yet.",
        prize_award: "Prize",
        bonus_award: "Bonus",
        certificate_award: "Certificate"
      }
      // Add other languages like ru, pl if needed
    };

    let currentLang = localStorage.getItem('lang') || 'uk';

    function applyTranslation(lang) {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.dataset.i18n;
        if (translations[lang] && translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.dataset.i18nPlaceholder; // Corrected: data-i18n-placeholder
        if (translations[lang] && translations[lang][key]) {
          element.placeholder = translations[lang][key];
        }
      });
    }

    // Function to show a specific section and update active nav item
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.section');
      const navItems = document.querySelectorAll('.nav-item');

      sections.forEach(section => section.classList.remove('active'));
      navItems.forEach(item => item.classList.remove('active'));

      document.getElementById(sectionId).classList.add('active');

      const correspondingNavItem = document.querySelector(`.nav-item[data-target="${sectionId}"]`);
      if (correspondingNavItem) {
        correspondingNavItem.classList.add('active');
      }
    }

    // Function to handle section navigation
    function setupNavigation() {
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          const targetId = item.dataset.target;
          showSection(targetId);
        });
      });

      // Special navigation for Awards <-> Tournament Details
      // This button now specifically goes back to Awards, not just "view details"
      document.getElementById('backToAwardsBtn').addEventListener('click', () => {
        showSection('awardsSection');
      });

      // Set initial active section (Home)
      showSection('homeSection');
    }

    // Dummy data for awards
    const myAwards = [
        { id: 'award1', type: 'prize', title: 'Призове місце в 1v1', description: 'Ви виграли турнір 1v1!', tournamentName: '1v1 Solo Cup', tournamentId: 'tournamentA', iconEmoji: '🏆', iconUrl: '' },
        { id: 'award2', type: 'bonus', title: 'Бонус за участь', description: 'Дякуємо за активну участь у турнірі.', tournamentName: 'RFORZ Grad Prix', tournamentId: 'tournamentB', iconEmoji: '🎁', iconUrl: '' },
        { id: 'award3', type: 'certificate', title: 'Сертифікат фіналіста', description: 'Ви досягли фіналу турніру.', tournamentName: 'Winter Championship', tournamentId: 'tournamentC', iconEmoji: '🏅', iconUrl: '' },
        { id: 'award4', type: 'prize', title: 'Приз за командний турнір', description: 'Ваша команда виграла фінал!', tournamentName: 'Spring Masters', tournamentId: 'tournamentD', iconEmoji: '🥇', iconUrl: '' },
    ];

    // Dummy data for ranking for different tournaments
    const allTournamentRankings = {
        'tournamentA': [
            { place: 1, team: 'Solo Champ', wins: 5, losses: 0 },
            { place: 2, team: 'Lone Wolf', wins: 3, losses: 2 },
            { place: 3, team: 'Quick Shooter', wins: 2, losses: 3 },
        ],
        'tournamentB': [
            { place: 1, team: 'Team Alpha', wins: 10, losses: 0 },
            { place: 2, team: 'Team Beta', wins: 8, losses: 2 },
            { place: 3, team: 'Team Gamma', wins: 7, losses: 3 },
            { place: 4, team: 'Team Delta', wins: 5, losses: 5 },
        ],
        'tournamentC': [
            { place: 1, team: 'Winter Conquerors', wins: 12, losses: 0 },
            { place: 2, team: 'Ice Warriors', wins: 9, losses: 3 },
            { place: 3, team: 'Snow Strikers', wins: 7, losses: 5 },
        ],
        'tournamentD': [
            { place: 1, team: 'Spring Champions', wins: 15, losses: 0 },
            { place: 2, team: 'Green Guardians', wins: 10, losses: 5 },
            { place: 3, team: 'Blossom Blitz', wins: 8, losses: 7 },
        ]
    };

    function renderMyAwards() {
        const awardsList = document.getElementById('myAwardsList');
        awardsList.innerHTML = ''; // Clear previous awards

        if (myAwards.length === 0) {
            awardsList.innerHTML = `<p style="text-align: center; color: #aaa;" data-i18n="no_awards_yet">${translations[currentLang]?.['no_awards_yet'] || 'Наразі у вас немає нагород.'}</p>`;
            return;
        }

        myAwards.forEach(award => {
            const awardCard = document.createElement('div');
            awardCard.classList.add('award-card');
            // Store tournamentId on the card for easy access
            awardCard.dataset.tournamentId = award.tournamentId;
            awardCard.dataset.tournamentName = award.tournamentName;

            const iconHtml = award.iconUrl
                ? `<img src="${award.iconUrl}" alt="Award Icon" class="award-card-img">`
                : `<span class="award-card-icon">${award.iconEmoji}</span>`;

            awardCard.innerHTML = `
                <div class="award-content-wrapper">
                    ${iconHtml}
                    <div class="award-text-content">
                        <h4>${award.title}</h4>
                        <p class="tournament-name-on-card">${award.tournamentName}</p>
                    </div>
                </div>
            `;
            // Add click listener to show tournament details
            awardCard.addEventListener('click', () => {
                showTournamentDetails(award.tournamentId, award.tournamentName);
            });
            awardsList.appendChild(awardCard);
        });
        applyTranslation(currentLang); // Re-apply translations for newly created elements
    }

    function renderRankingTable(tournamentId) {
        const rankingContainer = document.getElementById('rankingTableContainer');
        rankingContainer.innerHTML = ''; // Clear previous content

        const rankingData = allTournamentRankings[tournamentId];

        if (!rankingData || rankingData.length === 0) {
            rankingContainer.innerHTML = `<p style="text-align: center; color: #aaa;">Немає даних для рейтингу цього турніру.</p>`;
            return;
        }

        const table = document.createElement('table');
        table.classList.add('ranking-table');
        table.innerHTML = `
            <thead>
                <tr>
                    <th>Місце</th>
                    <th>Команда</th>
                    <th>Перемоги</th>
                    <th>Поразки</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        `;

        const tbody = table.querySelector('tbody');
        rankingData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.place}</td>
                <td>${row.team}</td>
                <td>${row.wins}</td>
                <td>${row.losses}</td>
            `;
            tbody.appendChild(tr);
        });

        rankingContainer.appendChild(table);
    }

    function showTournamentDetails(tournamentId, tournamentName) {
        const tournamentDetailsTitleElement = document.getElementById('tournamentDetailsTitle');
        // Update the title with the specific tournament name
        tournamentDetailsTitleElement.textContent = `${translations[currentLang]?.['tournament_details_title_dynamic'] || 'Деталі Турніру та Рейтинг'}: ${tournamentName}`;

        showSection('tournamentDetailsSection'); // Show the tournament details section
        renderRankingTable(tournamentId); // Render the specific ranking table
    }


    // --- Profile, Team, Notification Logic (from previous interactions) ---
    const telegramWebApp = window.Telegram.WebApp;
    telegramWebApp.ready();

    const avatarElement = document.getElementById('avatar');
    const profilePopup = document.getElementById('profilePopup');
    const registerBtn = document.getElementById('registerBtn');
    const profileForm = document.getElementById('profileForm');
    const doneBtn = document.getElementById('doneBtn');
    const playerProfile = document.getElementById('playerProfile');
    const createTeamBtn = document.getElementById('createTeamBtn');
    const teamForm = document.getElementById('teamForm');
    const teamDoneBtn = document.getElementById('teamDoneBtn');
    const teamAvatarInput = document.getElementById('teamAvatar');
    const teamAvatarPreview = document.getElementById('teamAvatarPreview');
    const successMsg = document.getElementById('successMsg');
    const teamSuccessMsg = document.getElementById('teamSuccessMsg');
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationPopup = document.getElementById('notificationPopup');
    const notificationList = document.getElementById('notificationList');
    const notificationBadge = document.getElementById('notificationBadge');
    const clearNotificationsBtn = document.getElementById('clearNotificationsBtn');
    const adminMenuBtn = document.getElementById('adminMenuBtn');
    const adminPopup = document.getElementById('adminPopup');
    const langBtn = document.getElementById('langBtn');
    const langPopup = document.getElementById('langPopup');

    let userProfile = JSON.parse(localStorage.getItem('userProfile')) || null;
    let userTeam = JSON.parse(localStorage.getItem('userTeam')) || null;
    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

    function updateProfileDisplay() {
      if (userProfile) {
        document.getElementById('profileNick').textContent = userProfile.standoffNick;
        document.getElementById('profileId').textContent = userProfile.standoffId;
        document.getElementById('tgUser').value = telegramWebApp.initDataUnsafe.user?.username || 'N/A'; // Ensure tgUser is updated in form too
        document.getElementById('profileTg').textContent = userProfile.tgUser;

        playerProfile.style.display = 'block';
        registerBtn.style.display = 'none';
        createTeamBtn.style.display = userTeam ? 'none' : 'block';
      } else {
        playerProfile.style.display = 'none';
        registerBtn.style.display = 'block';
        createTeamBtn.style.display = 'none';
      }
    }

    function updateTeamDisplay() {
      if (userTeam) {
        teamForm.style.display = 'none';
        createTeamBtn.style.display = 'none';
        // You might want to display team profile here if needed
      } else if (userProfile) {
        createTeamBtn.style.display = 'block';
      }
    }

    // Profile Popup Toggles
    avatarElement.addEventListener('click', () => {
      profilePopup.classList.toggle('active');
      // Close other popups
      langPopup.classList.remove('active');
      notificationPopup.classList.remove('active');
      adminPopup.classList.remove('active');
      if (profilePopup.classList.contains('active')) {
        profileForm.style.display = 'none';
        successMsg.style.display = 'none';
        teamForm.style.display = 'none';
        teamSuccessMsg.style.display = 'none';
        updateProfileDisplay();
        updateTeamDisplay();
      }
    });

    // Register Button (shows profile form)
    registerBtn.addEventListener('click', () => {
      profileForm.style.display = 'flex';
      registerBtn.style.display = 'none';
      playerProfile.style.display = 'none';
      document.getElementById('tgUser').value = telegramWebApp.initDataUnsafe.user?.username || 'N/A';
    });

    // Profile Form Submission
    profileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      userProfile = {
        standoffNick: document.getElementById('standoffNick').value,
        standoffId: document.getElementById('standoffId').value,
        tgUser: document.getElementById('tgUser').value
      };
      localStorage.setItem('userProfile', JSON.stringify(userProfile));
      successMsg.style.display = 'block';
      profileForm.style.display = 'none';
      updateProfileDisplay();
      setTimeout(() => successMsg.style.display = 'none', 3000);
    });

    // Create Team Button (shows team form)
    createTeamBtn.addEventListener('click', () => {
      teamForm.style.display = 'flex';
      createTeamBtn.style.display = 'none';
      playerProfile.style.display = 'none';
    });

    // Team Avatar Preview
    teamAvatarInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          teamAvatarPreview.src = e.target.result;
          teamAvatarPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        teamAvatarPreview.src = '#';
        teamAvatarPreview.style.display = 'none';
      }
    });

    // Team Form Submission
    teamForm.addEventListener('submit', (e) => {
      e.preventDefault();
      userTeam = {
        teamTag: document.getElementById('teamTag').value,
        teamName: document.getElementById('teamName').value,
        avatar: teamAvatarPreview.src, // Store base64 or URL
        players: [
          { id: document.getElementById('main1Id').value, nick: document.getElementById('main1Nick').value, tg: document.getElementById('main1Tg').value },
          { id: document.getElementById('main2Id').value, nick: document.getElementById('main2Nick').value, tg: document.getElementById('main2Tg').value },
          { id: document.getElementById('main3Id').value, nick: document.getElementById('main3Nick').value, tg: document.getElementById('main3Tg').value },
          { id: document.getElementById('main4Id').value, nick: document.getElementById('main4Nick').value, tg: document.getElementById('main4Tg').value },
          { id: document.getElementById('main5Id').value, nick: document.getElementById('main5Nick').value, tg: document.getElementById('main5Tg').value },
          { id: document.getElementById('spare1Id').value, nick: document.getElementById('spare1Nick').value, tg: document.getElementById('spare1Tg').value },
          { id: document.getElementById('spare2Id').value, nick: document.getElementById('spare2Nick').value, tg: document.getElementById('spare2Tg').value }
        ].filter(p => p.id && p.nick && p.tg) // Filter out empty players
      };
      localStorage.setItem('userTeam', JSON.stringify(userTeam));
      teamSuccessMsg.style.display = 'block';
      teamForm.style.display = 'none';
      updateTeamDisplay();
      setTimeout(() => teamSuccessMsg.style.display = 'none', 3000);
    });

    // Notification Logic
    function renderNotifications() {
      notificationList.innerHTML = '';
      if (notifications.length === 0) {
        notificationList.innerHTML = `<p style="text-align: center; color: #aaa;" data-i18n="no_notifications">${translations[currentLang]?.['no_notifications'] || 'У вас немає сповіщень.'}</p>`;
        return;
      }

      notifications.forEach((note, index) => {
        const notificationItem = document.createElement('div');
        notificationItem.classList.add('notification-item');
        notificationItem.style.cssText = `
          background: #292929;
          border-radius: 8px;
          padding: 10px 12px;
          margin-bottom: 8px;
          font-size: 0.95rem;
          color: #eee;
          position: relative;
        `;

        let message = '';
        switch (note.type) {
          case 'prize':
            message = `🏆 Вам видано приз! Користувач: ${note.data.user}`;
            break;
          case 'message':
            message = `✉️ Нове повідомлення: ${note.data.text}`;
            break;
          case 'team_invite':
            message = `👥 Запрошення до команди від ${note.data.teamName}`;
            break;
          default:
            message = `Нове сповіщення: ${JSON.stringify(note.data)}`;
        }
        notificationItem.textContent = message;

        const timestamp = document.createElement('div');
        timestamp.style.cssText = `
          font-size: 0.75rem;
          color: #aaa;
          margin-top: 4px;
        `;
        timestamp.textContent = new Date(note.timestamp).toLocaleString();
        notificationItem.appendChild(timestamp);

        const closeBtn = document.createElement('button');
        closeBtn.textContent = '✖';
        closeBtn.style.cssText = `
          position: absolute;
          top: 8px;
          right: 8px;
          background: none;
          border: none;
          color: #aaa;
          font-size: 0.9rem;
          cursor: pointer;
        `;
        closeBtn.addEventListener('click', () => {
          notifications.splice(index, 1);
          localStorage.setItem('notifications', JSON.stringify(notifications));
          renderNotifications();
          updateNotificationBadge();
        });
        notificationItem.appendChild(closeBtn);

        notificationList.appendChild(notificationItem);
      });
      applyTranslation(currentLang); // Re-apply translations for newly created elements
    }

    function updateNotificationBadge() {
      const unreadNotifications = notifications.length; // Simple count of all notifications
      if (unreadNotifications > 0) {
        notificationBadge.textContent = unreadNotifications;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
    }

    function addNotification(type, data = {}, userId = null) {
      let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
      const timestamp = new Date().toISOString();
      notifications.unshift({ type, data, timestamp, userId });
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
      updateNotificationBadge();
    }

    notificationBtn.addEventListener('click', () => {
      notificationPopup.classList.toggle('active');
      // Close other popups
      langPopup.classList.remove('active');
      profilePopup.classList.remove('active');
      adminPopup.classList.remove('active');
      if (notificationPopup.classList.contains('active')) {
        renderNotifications();
      }
    });

    clearNotificationsBtn.addEventListener('click', () => {
      notifications = [];
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
      updateNotificationBadge();
    });

    // Admin Menu Logic
    adminMenuBtn.addEventListener('click', () => {
      const userId = telegramWebApp.initDataUnsafe.user?.id;
      if (ADMIN_IDS.includes(userId)) {
        adminPopup.classList.toggle('active');
        // Close other popups
        langPopup.classList.remove('active');
        profilePopup.classList.remove('active');
        notificationPopup.classList.remove('active');
      } else {
        alert(translations[currentLang]?.['admin_access_denied'] || 'Ви не маєте доступу до адмін-меню.');
      }
    });

    // Close Admin Popup (using event delegation for the close button if it's dynamic)
    document.addEventListener('click', (event) => {
        if (event.target.id === 'closeAdminModal') {
            adminPopup.classList.remove('active');
        }
    });

    // Language switcher
    langBtn.addEventListener('click', () => {
      langPopup.classList.toggle('active');
      // Close other popups
      profilePopup.classList.remove('active');
      notificationPopup.classList.remove('active');
      adminPopup.classList.remove('active');
    });

    document.querySelectorAll('.lang-option').forEach(button => {
      button.addEventListener('click', () => {
        currentLang = button.dataset.lang;
        localStorage.setItem('lang', currentLang);
        applyTranslation(currentLang);
        langPopup.classList.remove('active');
        // Re-render dynamic content that uses translations
        renderNotifications();
        renderMyAwards();
      });
    });


    // Initial setup on load
    document.addEventListener('DOMContentLoaded', () => {
      applyTranslation(currentLang); // Apply default language
      setupNavigation(); // Setup navigation on load
      updateNotificationBadge(); // Initialize notification badge
      updateProfileDisplay(); // Initialize profile display
      updateTeamDisplay(); // Initialize team display
      renderMyAwards(); // Render awards on page load
      // No need to render a general ranking table on load if it's tied to award clicks
    });

    // Example admin actions (these would typically involve backend calls)
    document.getElementById('banUserBtn').addEventListener('click', () => {
      // Example: fetch('/api/ban_user', { method: 'POST', body: JSON.stringify({ userId: someUserId }) });
      alert(translations[currentLang]?.['ban_user'] || 'Функція "Заблокувати користувача" (розробка)');
      adminPopup.classList.remove('active');
    });
    document.getElementById('unbanUserBtn').addEventListener('click', () => {
      alert(translations[currentLang]?.['unban_user'] || 'Функція "Розблокувати користувача" (розробка)');
      adminPopup.classList.remove('active');
    });
    document.getElementById('givePrizeBtn').addEventListener('click', () => {
      alert(translations[currentLang]?.['give_prize'] || 'Функція "Видати приз" (розробка)');
      // Example: addNotification('prize', { user: 'TestUser' }, 123);
      adminPopup.classList.remove('active');
    });
    document.getElementById('disqualifyTeamBtn').addEventListener('click', () => {
      alert(translations[currentLang]?.['disqualify_team'] || 'Функція "Дискваліфікувати команду" (розробка)');
      adminPopup.classList.remove('active');
    });
    document.getElementById('editBracketBtn').addEventListener('click', () => {
      alert(translations[currentLang]?.['edit_bracket'] || 'Функція "Модерувати сітку" (розробка)');
      adminPopup.classList.remove('active');
    });

  </script>
</body>
</html>
