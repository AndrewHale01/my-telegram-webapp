<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telegram WebApp</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZN665FNYF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TZN665FNYF');
  </script>
      <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      padding-bottom: 60px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      position: relative;
    }
    .lang-btn {
      font-size: 1.5rem;
      cursor: pointer;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #00bfae;
      cursor: pointer;
      object-fit: cover;
      background: #111;
      transition: box-shadow 0.2s;
    }
    .avatar-small:hover {
      box-shadow: 0 0 0 4px #00bfae55;
    }

    /* Popup —Å—Ç–∏–ª—ñ */
    .popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 0;
      background: #333;
      padding: 24px 20px 20px 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 10;
      flex-direction: column;
      min-width: 260px;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    .popup.active {
      display: flex;
    }

    .register-btn, .done-btn, .create-team-btn {
      background: #2196f3;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
      transition: background 0.2s;
      width: 100%;
      max-width: 220px;
    }
    .register-btn:hover, .done-btn:hover, .create-team-btn:hover {
      background: #1976d2;
    }

    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
    }
    .profile-form label {
      font-size: 0.95rem;
      color: #bbb;
      margin-bottom: 2px;
    }
    .profile-form input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
    .profile-form input[readonly] {
      background: #222;
      color: #aaa;
      border: 1px solid #444;
    }

    .player-profile {
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
      margin-bottom: 8px;
      background: #222;
      border-radius: 10px;
      padding: 12px 14px;
      color: #fff;
      font-size: 1rem;
      display: none;
    }
    .player-profile-title {
      margin-bottom: 8px;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.05rem;
    }
    .player-profile-row {
      margin-bottom: 4px;
      word-break: break-word;
    }

    .success-message, .team-success-message {
      color: #00bfae;
      font-size: 1rem;
      margin: 10px 0 0 0;
      text-align: center;
    }

    .team-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 340px;
      margin-top: 8px;
      align-items: center;
    }
    .team-form label {
      font-size: 0.95rem;
      color: #bbb;
      margin-bottom: 2px;
      align-self: flex-start;
    }
    .team-form input[type="text"] {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
    .team-form input[type="file"] {
      color: #fff;
      margin-bottom: 8px;
      align-self: flex-start;
    }
    .team-avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #00bfae;
      margin-bottom: 8px;
      background: #111;
      display: none;
    }
    .team-player-block {
      background: #292929;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .team-player-title {
      color: #00bfae;
      font-weight: bold;
      margin-bottom: 4px;
      font-size: 1rem;
    }

    .notification-btn {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      position: relative;
      margin-left: 8px;
      color: #fff;
    }
    .notification-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: #e53935;
      color: #fff;
      border-radius: 50%;
      font-size: 0.85rem;
      min-width: 20px;
      min-height: 20px;
      padding: 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid #222;
      box-sizing: border-box;
      z-index: 2;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95);}
      to { opacity: 1; transform: scale(1);}
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active, .nav-item:hover {
      color: #00bfae;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="lang-btn" id="langBtn">üåê</div>
    <img id="avatar" class="avatar-small" src="avatar.jpg" alt="Avatar">
    <button id="notificationBtn" class="notification-btn" title="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è">
      üîî
      <span id="notificationBadge" class="notification-badge" style="display:none;">0</span>
    </button>
    <button id="adminMenuBtn" title="–ê–¥–º—ñ–Ω-–º–µ–Ω—é">üõ°Ô∏è</button>
        <div id="profilePopup" class="popup">
      <button class="register-btn" id="registerBtn" data-i18n="register">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
      <form class="profile-form" id="profileForm" style="display:none;">
        <label for="standoffNick" data-i18n="standoff_nick">–ù—ñ–∫ –≤ Standoff</label>
        <input type="text" id="standoffNick" name="standoffNick" required maxlength="32" autocomplete="off">
        <label for="standoffId" data-i18n="standoff_id">ID –≤ Standoff</label>
        <input type="text" id="standoffId" name="standoffId" required maxlength="32" autocomplete="off">
        <label for="tgUser" data-i18n="tg_user">Telegram</label>
        <input type="text" id="tgUser" name="tgUser" readonly>
        <button type="submit" class="done-btn" id="doneBtn" data-i18n="done">–ì–æ—Ç–æ–≤–æ</button>
      </form>
      <div class="player-profile" id="playerProfile">
        <div class="player-profile-title" data-i18n="profile">–ü—Ä–æ—Ñ—ñ–ª—å –≥—Ä–∞–≤—Ü—è</div>
        <div class="player-profile-row"><span data-i18n="standoff_nick">–ù—ñ–∫ –≤ Standoff</span>: <span id="profileNick"></span></div>
        <div class="player-profile-row"><span data-i18n="standoff_id">ID –≤ Standoff</span>: <span id="profileId"></span></div>
        <div class="player-profile-row"><span data-i18n="tg_user">Telegram</span>: <span id="profileTg"></span></div>
      </div>
      <button class="create-team-btn" id="createTeamBtn" style="display:none;" data-i18n="create_team">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>
      <div class="success-message" id="successMsg" style="display:none;" data-i18n="profile_saved">–ü—Ä–æ—Ñ—ñ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!</div>
            <form class="team-form" id="teamForm" style="display:none;">
        <label for="teamAvatar" data-i18n="team_avatar">–ê–≤–∞—Ç–∞—Ä–∫–∞ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="file" id="teamAvatar" accept="image/*">
        <img id="teamAvatarPreview" class="team-avatar-preview" src="#" alt="Team Avatar">

        <label for="teamTag" data-i18n="team_tag">–¢–µ–≥ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="text" id="teamTag" maxlength="12" required data-i18n-placeholder="team_tag_ph">

        <label for="teamName" data-i18n="team_name">–ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="text" id="teamName" maxlength="32" required data-i18n-placeholder="team_name_ph">

        <!-- –ì—Ä–∞–≤—Ü—ñ: 5 –æ—Å–Ω–æ–≤–Ω–∏—Ö, 2 –∑–∞–ø–∞—Å–Ω–∏—Ö -->
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player1">–ì—Ä–∞–≤–µ—Ü—å 1 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" id="main1Id" placeholder="ID –≤ Standoff 2" required data-i18n-placeholder="player_id_ph">
          <input type="text" id="main1Nick" placeholder="–ù—ñ–∫–Ω–µ–π–º" required data-i18n-placeholder="player_nick_ph">
          <input type="text" id="main1Tg" placeholder="Telegram" required data-i18n-placeholder="player_tg_ph">
        </div>

        <!-- –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –±–ª–æ–∫ .team-player-block –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è... -->
        <!-- –©–æ–±–∏ –∑–µ–∫–æ–Ω–æ–º–∏—Ç–∏ –º—ñ—Å—Ü–µ —Ç—É—Ç, —è –Ω–µ –¥—É–±–ª—é–≤–∞—Ç–∏–º—É —É—Å—ñ –≥—Ä–∞–≤—Ü—ñ HTML ‚Äî –∞–ª–µ —Ç–∏ –≤–∂–µ –π–æ–≥–æ –º–∞—î—à —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö -->

        <button type="submit" class="done-btn" id="teamDoneBtn" data-i18n="team_done">–ì–æ—Ç–æ–≤–æ</button>
      </form>

      <div class="team-success-message" id="teamSuccessMsg" style="display:none;" data-i18n="team_created">–ö–æ–º–∞–Ω–¥—É —Å—Ç–≤–æ—Ä–µ–Ω–æ!</div>
    </div>

    <!-- –ü–æ–ø–∞–ø–∏: –º–æ–≤–∞ —ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è -->
    <div id="langPopup" class="popup">
      <button class="lang-option" data-lang="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
      <button class="lang-option" data-lang="en">English</button>
    </div>

    <div id="notificationPopup" class="popup" style="right:60px; min-width:280px;">
      <div style="font-weight:bold; color:#00bfae; margin-bottom:8px;" id="notificationTitle">–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</div>
      <div id="notificationList" style="width:100%;"></div>
      <button id="clearNotificationsBtn" class="done-btn" style="margin-top:10px;">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>
  </div>
    <div class="main-section active" id="mainSection">
    <div class="news-section">
      <div class="news-title" data-i18n="news">–ù–æ–≤–∏–Ω–∏</div>
      <div class="news-list" id="newsList">
        <div class="news-card">
          <h4 data-i18n="news4title">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–æ–ª—å—Å—å–∫–æ—ó!</h4>
          <p data-i18n="news4desc">–¢–µ–ø–µ—Ä –≤ –Ω–∞—à–æ–º—É –¥–æ–¥–∞—Ç–∫—É –∑'—è–≤–∏–ª–∞—Å—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–æ–ª—å—Å—å–∫–æ—ó –º–æ–≤–∏.</p>
        </div>
        <div class="news-card">
          <h4 data-i18n="news5title">–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—É—Ä–Ω—ñ—Ä—ñ–≤!</h4>
          <p data-i18n="news5desc">–†–æ–∑–¥—ñ–ª "–¢—É—Ä–Ω—ñ—Ä–∏" –æ–Ω–æ–≤–ª–µ–Ω–æ!</p>
        </div>
      </div>
    </div>

    <div class="disciplines-section">
      <div class="disciplines-title" data-i18n="disciplines">–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏</div>
      <div class="disciplines-list">
        <div class="discipline-card">
          <img src="Standoff2.jpg" alt="Standoff 2" class="discipline-img">
          <div class="discipline-name">Standoff 2</div>
        </div>
      </div>
    </div>

    <div class="tournaments-section">
      <div class="tournaments-title" data-i18n="tournaments">–¢—É—Ä–Ω—ñ—Ä–∏</div>
      <div class="tournament-list" id="tournamentList">
        <div class="tournament-card">
          <h4>RFORZ Grad Prix Season 1</h4>
          <p data-i18n="tournament1desc">–ü–æ—á–∞—Ç–æ–∫: 1 –ª–∏–ø–Ω—è. –ü—Ä–∏–∑–æ–≤–∏–π —Ñ–æ–Ω–¥: 5000‚Ç¥</p>
        </div>
        <div class="tournament-card">
          <h4>Quiz Battle</h4>
          <p data-i18n="tournament2desc">–ü–æ—á–∞—Ç–æ–∫: 10 –ª–∏–ø–Ω—è. –ü—Ä–∏–∑–æ–≤–∏–π —Ñ–æ–Ω–¥: 2000‚Ç¥</p>
        </div>
      </div>
    </div>
  </div>

  <div class="rules-section" id="rulesSection">
    <details class="dropdown">
      <summary id="rule1x1Title">1x1</summary>
      <div class="dropdown-content" id="rule1x1Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule2x2Title">2x2</summary>
      <div class="dropdown-content" id="rule2x2Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule5x5Title">5x5</summary>
      <div class="dropdown-content" id="rule5x5Content"></div>
    </details>
  </div>

  <div class="awards-section" id="awardsSection"></div>
  <div class="support-section" id="supportSection"></div>

  <div class="bottom-nav">
    <div class="nav-item active" id="navHome" data-target="mainSection"><span>üè†</span><p data-i18n="home">–ì–æ–ª–æ–≤–Ω–∞</p></div>
    <div class="nav-item" id="navRules" data-target="rulesSection"><span>üìÑ</span><p data-i18n="rules">–ü—Ä–∞–≤–∏–ª–∞</p></div>
    <div class="nav-item" id="navAwards" data-target="awardsSection"><span>üèÜ</span><p data-i18n="awards">–ù–∞–≥–æ—Ä–æ–¥–∏</p></div>
    <div class="nav-item" id="navSupport" data-target="supportSection"><span>ü§ñ</span><p data-i18n="support">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</p></div>
  </div>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  const profilePopup = document.getElementById('profilePopup');
  const avatar = document.getElementById('avatar');
  const registerBtn = document.getElementById('registerBtn');
  const profileForm = document.getElementById('profileForm');
  const doneBtn = document.getElementById('doneBtn');
  const standoffNickInput = document.getElementById('standoffNick');
  const standoffIdInput = document.getElementById('standoffId');
  const tgUserInput = document.getElementById('tgUser');
  const playerProfile = document.getElementById('playerProfile');
  const profileNick = document.getElementById('profileNick');
  const profileId = document.getElementById('profileId');
  const profileTg = document.getElementById('profileTg');
  const successMsg = document.getElementById('successMsg');
  const createTeamBtn = document.getElementById('createTeamBtn');
  const teamForm = document.getElementById('teamForm');
  const teamSuccessMsg = document.getElementById('teamSuccessMsg');
  const teamAvatarInput = document.getElementById('teamAvatar');
  const teamAvatarPreview = document.getElementById('teamAvatarPreview');
  const langBtn = document.getElementById('langBtn');
  const langPopup = document.getElementById('langPopup');
  const notificationBtn = document.getElementById('notificationBtn');
  const notificationPopup = document.getElementById('notificationPopup');
  const notificationList = document.getElementById('notificationList');
  const notificationBadge = document.getElementById('notificationBadge');
  const navItems = document.querySelectorAll('.nav-item');
  const adminMenuBtn = document.getElementById('adminMenuBtn');
  const adminModal = document.getElementById('adminModal');
  const closeAdminModal = document.getElementById('closeAdminModal');

  let currentLanguage = localStorage.getItem('language') || 'uk';
  const translations = { /* uk + en –æ–± º—î–∫—Ç —Ç—É—Ç */ };

  function translatePage() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (translations[currentLanguage][key]) el.textContent = translations[currentLanguage][key];
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.dataset.i18nPlaceholder;
      if (translations[currentLanguage][key]) el.placeholder = translations[currentLanguage][key];
    });
  }

  function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    translatePage();
  }

  document.querySelectorAll('.lang-option').forEach(btn => {
    btn.addEventListener('click', () => {
      setLanguage(btn.dataset.lang);
      langPopup.classList.remove('active');
    });
  });

  avatar.addEventListener('click', () => {
    profilePopup.classList.toggle('active');
    langPopup.classList.remove('active');
    notificationPopup.classList.remove('active');
  });

  langBtn.addEventListener('click', () => {
    langPopup.classList.toggle('active');
    profilePopup.classList.remove('active');
    notificationPopup.classList.remove('active');
  });

  notificationBtn.addEventListener('click', () => {
    notificationPopup.classList.toggle('active');
    profilePopup.classList.remove('active');
    langPopup.classList.remove('active');
  });

  document.addEventListener('click', (e) => {
    if (!profilePopup.contains(e.target) && e.target !== avatar) profilePopup.classList.remove('active');
    if (!langPopup.contains(e.target) && e.target !== langBtn) langPopup.classList.remove('active');
    if (!notificationPopup.contains(e.target) && e.target !== notificationBtn && !notificationBadge.contains(e.target)) notificationPopup.classList.remove('active');
  });

  const savedProfile = localStorage.getItem('userProfile');
  if (savedProfile) {
    const profile = JSON.parse(savedProfile);
    displayProfile(profile);
    registerBtn.style.display = 'none';
    createTeamBtn.style.display = 'block';
  } else {
    registerBtn.style.display = 'block';
    profileForm.style.display = 'none';
    playerProfile.style.display = 'none';
    createTeamBtn.style.display = 'none';
  }

  if (tg.initDataUnsafe?.user) {
    tgUserInput.value = tg.initDataUnsafe.user.username || tg.initDataUnsafe.user.first_name || 'N/A';
  }

  registerBtn.addEventListener('click', () => {
    registerBtn.style.display = 'none';
    profileForm.style.display = 'flex';
    playerProfile.style.display = 'none';
    successMsg.style.display = 'none';
    createTeamBtn.style.display = 'none';
  });

  profileForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const standoffNick = standoffNickInput.value;
    const standoffId = standoffIdInput.value;
    const tgUser = tgUserInput.value;
    const profile = { standoffNick, standoffId, tgUser };
    localStorage.setItem('userProfile', JSON.stringify(profile));
    displayProfile(profile);
    profileForm.style.display = 'none';
    successMsg.style.display = 'block';
    createTeamBtn.style.display = 'block';
  });

  function displayProfile(profile) {
    profileNick.textContent = profile.standoffNick;
    profileId.textContent = profile.standoffId;
    profileTg.textContent = profile.tgUser;
    playerProfile.style.display = 'block';
  }

  createTeamBtn.addEventListener('click', () => {
    teamForm.style.display = 'flex';
    createTeamBtn.style.display = 'none';
    teamSuccessMsg.style.display = 'none';
    profilePopup.classList.remove('active');
  });

  teamAvatarInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        teamAvatarPreview.src = e.target.result;
        teamAvatarPreview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      teamAvatarPreview.src = '#';
      teamAvatarPreview.style.display = 'none';
    }
  });

  teamForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const teamName = document.getElementById('teamName').value;
    const teamTag = document.getElementById('teamTag').value;
    const captainUsername = tg.initDataUnsafe.user?.username || 'unknown';

    const players = [];
    for (let i = 1; i <= 5; i++) {
      const id = document.getElementById(`main${i}Id`).value;
      const nick = document.getElementById(`main${i}Nick`).value;
      const tg = document.getElementById(`main${i}Tg`).value;
      if (id && nick) players.push({ id, nick, tg });
    }
    for (let i = 1; i <= 2; i++) {
      const id = document.getElementById(`sub${i}Id`).value;
      const nick = document.getElementById(`sub${i}Nick`).value;
      const tg = document.getElementById(`sub${i}Tg`).value;
      if (id && nick) players.push({ id, nick, tg });
    }

    const teamData = {
      team_name: teamName,
      team_tag: teamTag,
      captain_username: captainUsername,
      players: players.filter(p => p.tg).map(p => p.tg)
    };

    try {
      const res = await fetch('/api/create_team', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(teamData),
      });
      const result = await res.json();
      if (result.success) {
        const invited = teamData.players.length > 0 ? teamData.players.map(u => `@${u}`).join(', ') : '–Ω–µ–º–∞—î';
        addNotification('team_created_captain', { teamName, invitedUsers: invited });
        teamForm.style.display = 'none';
        teamSuccessMsg.style.display = 'block';
        createTeamBtn.style.display = 'block';
      } else {
        alert(`–ü–æ–º–∏–ª–∫–∞: ${result.message}`);
      }
    } catch (err) {
      console.error(err);
      alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥–∏.');
    }
  });

  const ADMIN_IDS = new Set([5806282517]);
  if (tg.initDataUnsafe?.user?.id && ADMIN_IDS.has(tg.initDataUnsafe.user.id)) {
    adminMenuBtn.style.display = 'block';
    adminMenuBtn.addEventListener('click', () => {
      adminModal.classList.toggle('active');
    });
    closeAdminModal.addEventListener('click', () => {
      adminModal.classList.remove('active');
    });
  }
</script>
</body>
</html>
