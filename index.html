<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      padding-bottom: 60px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      position: relative;
    }
    .lang-btn {
      font-size: 1.5rem;
      cursor: pointer;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #00bfae;
      object-fit: cover;
      background: #111;
    }
    .popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 0;
      background: #333;
      padding: 24px 20px 20px 20px;
      border-radius: 16px;
      z-index: 10;
      flex-direction: column;
      min-width: 260px;
      animation: fadeIn 0.2s;
    }
    .popup.active {
      display: flex;
    }
    .register-btn, .done-btn, .create-team-btn {
      background: #2196f3;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
      width: 100%;
      max-width: 220px;
    }
    .main-section, .rules-section, .support-section, .awards-section {
      display: none;
      padding: 0 16px;
    }
    .main-section.active,
    .rules-section.active,
    .support-section.active,
    .awards-section.active {
      display: block;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active,
    .nav-item:hover {
      color: #00bfae;
    }
    .team-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 340px;
      margin-top: 8px;
      align-items: center;
    }
    .team-form input[type="text"] {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      width: 100%;
    }
    .team-form label {
      color: #bbb;
      align-self: flex-start;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="lang-btn" onclick="toggleLang()">üåê</div>
    <img src="avatar.jpg" alt="avatar" class="avatar-small" onclick="toggleProfile()">
  </div>

  <div id="main" class="main-section active">
    <h2>üè† –ì–æ–ª–æ–≤–Ω–∞</h2>
    <p>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Telegram WebApp!</p>
  </div>

  <div id="rules" class="rules-section">
    <h2>üìú –ü—Ä–∞–≤–∏–ª–∞</h2>
    <p>–û—Å—å —Ç—É—Ç –±—É–¥—É—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —É—á–∞—Å—Ç—ñ...</p>
  </div>

  <!-- –ê–¥–º—ñ–Ω—Å—å–∫–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
  <div id="adminModal" style="display:none;">
    <div id="adminModalContent">
      <h3>üõ°Ô∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h3>
      <button onclick="openModeration()">üîß –ú–æ–¥–µ—Ä–∞—Ü—ñ—è</button>
      <button id="viewUserHistoryBtn">üìú –Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
      <div id="adminResult"></div>
    </div>
  </div>

  <!-- –ë–ª–æ–∫ –ø–µ—Ä–µ–≥–ª—è–¥—É –ª–æ–≥—ñ–≤ -->
  <div id="logViewer"
       style="display:none; margin-top:20px; max-height:300px;
              overflow-y:auto; font-size:0.9rem; color:#ccc; padding:10px;">
  </div>

  <!-- –ù–∏–∂–Ω—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è -->
  <div class="bottom-nav">
    <div class="nav-item" data-section="main" onclick="showSection('main')">
      <span>üè†</span>–ì–æ–ª–æ–≤–Ω–∞
    </div>
    <div class="nav-item" data-section="rules" onclick="showSection('rules')">
      <span>üìú</span>–ü—Ä–∞–≤–∏–ª–∞
    </div>
    <div class="nav-item" onclick="toggleAdmin()">
      <span>üõ°Ô∏è</span>–ê–¥–º—ñ–Ω
    </div>
  </div>
  <!-- üîπ –§–æ—Ä–º–∞ –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
  <form id="profileForm">
    <label for="nickname" data-i18n="nickname">–ù—ñ–∫ –≤ Standoff 2</label>
    <input type="text" id="nickname" required maxlength="32" autocomplete="off">

    <label for="standoffId" data-i18n="standoff_id">ID –≤ Standoff 2</label>
    <input type="text" id="standoffId" required maxlength="32" autocomplete="off">

    <label for="tgUser" data-i18n="tg_user">Telegram</label>
    <input type="text" id="tgUser" readonly>

    <button type="submit" class="done-btn" id="doneBtn" data-i18n="done">–ì–æ—Ç–æ–≤–æ</button>
  </form>

  <div class="player-profile" id="playerProfile" style="display: none;">
    <div class="player-profile-title" data-i18n="profile">–ü—Ä–æ—Ñ—ñ–ª—å –≥—Ä–∞–≤—Ü—è</div>
    <div class="player-profile-row"><span data-i18n="standoff_nick">–ù—ñ–∫ –≤ Standoff</span>: <span id="profileNick"></span></div>
    <div class="player-profile-row"><span data-i18n="standoff_id">ID –≤ Standoff</span>: <span id="profileId"></span></div>
    <div class="player-profile-row"><span data-i18n="tg_user">Telegram</span>: <span id="profileTg"></span></div>
  </div>

  <!-- üîπ –ö–Ω–æ–ø–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ -->
  <button class="create-team-btn" id="createTeamBtn" style="display:none;" data-i18n="create_team">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>
  <div class="team-success-message" id="teamSuccessMsg" style="display:none;" data-i18n="team_created">–ö–æ–º–∞–Ω–¥—É —Å—Ç–≤–æ—Ä–µ–Ω–æ!</div>

  <!-- üîπ –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ -->
  <form class="team-form" id="teamForm" style="display:none;">
    <label for="teamAvatar" data-i18n="team_avatar">–ê–≤–∞—Ç–∞—Ä–∫–∞ –∫–æ–º–∞–Ω–¥–∏</label>
    <input type="file" id="teamAvatar" accept="image/*">
    <img id="teamAvatarPreview" class="team-avatar-preview" src="#" alt="Team Avatar">

    <label for="teamTag" data-i18n="team_tag">–¢–µ–≥ –∫–æ–º–∞–Ω–¥–∏</label>
    <input type="text" id="teamTag" maxlength="12" required data-i18n-placeholder="team_tag_ph">

    <label for="teamName" data-i18n="team_name">–ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏</label>
    <input type="text" id="teamName" maxlength="32" required data-i18n-placeholder="team_name_ph">
    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 1 (–∫–∞–ø—ñ—Ç–∞–Ω) -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="main_player1">–ì—Ä–∞–≤–µ—Ü—å 1 (–∫–∞–ø—ñ—Ç–∞–Ω)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="main1Id" required data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main1Nick" required data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="main1Tg" required data-i18n-placeholder="player_tg_ph">
    </div>

    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 2 -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="main_player2">–ì—Ä–∞–≤–µ—Ü—å 2 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="main2Id" required data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main2Nick" required data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="main2Tg" required data-i18n-placeholder="player_tg_ph">
    </div>

    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 3 -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="main_player3">–ì—Ä–∞–≤–µ—Ü—å 3 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="main3Id" required data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main3Nick" required data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="main3Tg" required data-i18n-placeholder="player_tg_ph">
    </div>

    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 4 -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="main_player4">–ì—Ä–∞–≤–µ—Ü—å 4 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="main4Id" required data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main4Nick" required data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="main4Tg" required data-i18n-placeholder="player_tg_ph">
    </div>
    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 5 -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="main_player5">–ì—Ä–∞–≤–µ—Ü—å 5 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="main5Id" required data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main5Nick" required data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="main5Tg" required data-i18n-placeholder="player_tg_ph">
    </div>

    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 6 (–∑–∞–ø–∞—Å–Ω–∏–π) -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="sub_player1">–ì—Ä–∞–≤–µ—Ü—å 6 (–∑–∞–ø–∞—Å–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="sub1Id" data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="sub1Nick" data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="sub1Tg" data-i18n-placeholder="player_tg_ph">
    </div>

    <!-- üîπ –ì—Ä–∞–≤–µ—Ü—å 7 (–∑–∞–ø–∞—Å–Ω–∏–π) -->
    <div class="team-player-block">
      <div class="team-player-title" data-i18n="sub_player2">–ì—Ä–∞–≤–µ—Ü—å 7 (–∑–∞–ø–∞—Å–Ω–∏–π)</div>
      <input type="text" placeholder="ID –≤ Standoff 2" id="sub2Id" data-i18n-placeholder="player_id_ph">
      <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="sub2Nick" data-i18n-placeholder="player_nick_ph">
      <input type="text" placeholder="Telegram" id="sub2Tg" data-i18n-placeholder="player_tg_ph">
    </div>

    <button type="submit" class="done-btn" id="teamDoneBtn" data-i18n="team_done">–ì–æ—Ç–æ–≤–æ</button>
  </form>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tg = window.Telegram.WebApp;
  tg.ready();

  const user = tg.initDataUnsafe.user;
  const adminIds = [123456789, 987654321]; // üîÅ –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ ID

  // üëë –ü–æ–∫–∞–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
  if (adminIds.includes(user.id)) {
    const modal = document.getElementById("adminModal");
    if (modal) modal.style.display = "block";
  }

  // üìú –ö–Ω–æ–ø–∫–∞ ‚Äî –ø–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
  const btn = document.getElementById("viewUserHistoryBtn");
  if (btn) {
    btn.onclick = async function () {
      const res = await fetch("/api/logs");
      const logs = await res.json();
      const container = document.getElementById("logViewer");
      container.innerHTML = logs.map(log =>
        `<div>üìå <b>@${log.username}</b> ‚Üí ${log.action} (${log.timestamp})</div>`
      ).join('');
      container.style.display = "block";
    };
  }

  // üìÇ –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–æ—Ä–º—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏
  const createTeamBtn = document.getElementById("createTeamBtn");
  const teamForm = document.getElementById("teamForm");
  const teamSuccessMsg = document.getElementById("teamSuccessMsg");

  if (createTeamBtn) {
    createTeamBtn.addEventListener("click", () => {
      createTeamBtn.style.display = "none";
      teamForm.style.display = "flex";
      teamSuccessMsg.style.display = "none";
    });
  }

  // ‚úÖ –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏ –∫–æ–º–∞–Ω–¥–∏
  const teamDoneBtn = document.getElementById("teamForm");
  if (teamDoneBtn) {
    teamDoneBtn.addEventListener("submit", async (e) => {
      e.preventDefault();

      const players = [
        "main1Tg", "main2Tg", "main3Tg", "main4Tg", "main5Tg", "sub1Tg", "sub2Tg"
      ].map(id => document.getElementById(id)?.value).filter(Boolean);

      const data = {
        captain_username: user.username,
        team_name: document.getElementById("teamName")?.value,
        team_tag: document.getElementById("teamTag")?.value,
        players: players
      };

      const res = await fetch("/api/create_team", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        teamForm.style.display = "none";
        teamSuccessMsg.style.display = "block";
      }
    });
  }
});
</script>
<script>
  // üîÅ –ü–µ—Ä–µ–∫–ª–∞–¥ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
  const translations = {
    uk: {
      create_team: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É",
      team_created: "–ö–æ–º–∞–Ω–¥—É —Å—Ç–≤–æ—Ä–µ–Ω–æ!",
      profile_saved: "–ü—Ä–æ—Ñ—ñ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!",
      team_tag_ph: "–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥",
      team_name_ph: "–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏",
      player_id_ph: "ID –≤ Standoff",
      player_nick_ph: "–ù—ñ–∫–Ω–µ–π–º",
      player_tg_ph: "Telegram"
    },
    en: {
      create_team: "Create team",
      team_created: "Team created!",
      profile_saved: "Profile saved!",
      team_tag_ph: "Enter tag",
      team_name_ph: "Enter team name",
      player_id_ph: "Standoff ID",
      player_nick_ph: "Nickname",
      player_tg_ph: "Telegram"
    }
  };

  const currentLang = "uk";

  function translateTeamForm(lang) {
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      if (translations[lang] && translations[lang][key]) {
        el.textContent = translations[lang][key];
      }
    });

    document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
      const key = el.getAttribute("data-i18n-placeholder");
      if (translations[lang] && translations[lang][key]) {
        el.placeholder = translations[lang][key];
      }
    });
  }

  translateTeamForm(currentLang);

  // üîÅ –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å–µ–∫—Ü—ñ–π
  function showSection(sectionId) {
    document.querySelectorAll(".main-section, .rules-section, .support-section, .awards-section")
      .forEach(sec => sec.classList.remove("active"));
    document.getElementById(sectionId).classList.add("active");
  }

  // üîÅ –ü–æ–∫–∞–∑/—Å—Ö–æ–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
  function toggleProfile() {
    const prof = document.getElementById("playerProfile");
    if (prof) prof.style.display = prof.style.display === "none" ? "block" : "none";
  }

  // üîÅ –ü–æ–∫–∞–∑ –∞–¥–º—ñ–Ω–∫–∏
  function toggleAdmin() {
    const modal = document.getElementById("adminModal");
    if (modal) modal.style.display = modal.style.display === "none" ? "block" : "none";
  }

  // üîÅ –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º–æ–≤–∏ (–ø—Ä–æ—Å—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è)
  function toggleLang() {
    const lang = currentLang === "uk" ? "en" : "uk";
    translateTeamForm(lang);
  }
</script>

</body>
</html>
