<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telegram WebApp</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZN665FNYF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TZN665FNYF');
  </script>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      padding-bottom: 60px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      position: relative;
    }
    .lang-btn {
      font-size: 1.5rem;
      cursor: pointer;
      margin-right: 0px;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #00bfae;
      cursor: pointer;
      object-fit: cover;
      background: #111;
      transition: box-shadow 0.2s;
    }
    .avatar-small:hover {
      box-shadow: 0 0 0 4px #00bfae55;
    }
    .popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 0;
      background: #333;
      padding: 24px 20px 20px 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 10;
      flex-direction: column;
      min-width: 260px;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    .popup.active {
      display: flex;
    }
    .register-btn, .done-btn, .create-team-btn {
      background: #2196f3;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
      transition: background 0.2s;
      width: 100%;
      max-width: 220px;
    }
    .register-btn:hover, .done-btn:hover, .create-team-btn:hover {
      background: #1976d2;
    }
    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
    }
    .profile-form label {
      font-size: 0.95rem;
      color: #bbb;
      margin-bottom: 2px;
    }
    .profile-form input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
    .profile-form input[readonly] {
      background: #222;
      color: #aaa;
      border: 1px solid #444;
    }
    .success-message {
      color: #00bfae;
      font-size: 1rem;
      margin: 10px 0 0 0;
      text-align: center;
    }
    .player-profile {
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
      margin-bottom: 8px;
      background: #222;
      border-radius: 10px;
      padding: 12px 14px;
      color: #fff;
      font-size: 1rem;
      box-sizing: border-box;
      display: none;
    }
    .player-profile-title {
      margin-bottom: 8px;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.05rem;
    }
    .player-profile-row {
      margin-bottom: 4px;
      word-break: break-word;
    }
    .lang-option {
      background: #444;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 5px;
    }
    .lang-option:hover {
      background: #555;
    }
    #langPopup {
      left: 0;
      right: auto;
    }
    .main-section, .rules-section, .awards-section, .support-section {
      display: none;
      padding: 0 16px;
    }
    .main-section.active, .rules-section.active, .awards-section.active, .support-section.active {
      display: block;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active, .nav-item:hover {
      color: #00bfae;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95);}
      to { opacity: 1; transform: scale(1);}
    }
    .news-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .news-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .news-list {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding-bottom: 8px;
      scrollbar-width: thin;
    }
    .news-card {
      min-width: 220px;
      background: #333;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px #0005;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .news-card p {
      margin: 0;
      font-size: 0.95rem;
      color: #fff;
      word-break: break-word;
      white-space: normal;
      overflow-wrap: break-word;
      max-width: 100%;
    }
    .news-card h4 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      color: #00bfae;
    }
    .disciplines-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .disciplines-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .disciplines-list {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    .discipline-card {
      background: #333;
      border-radius: 12px;
      padding: 10px 14px;
      box-shadow: 0 2px 8px #0005;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 320px;
      max-width: 320px;
      border: 4px solid #00bfae;
    }
    .discipline-img {
      width: 320px;
      height: 320px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 8px;
      background: #222;
      border: none;
      display: block;
    }
    .discipline-name {
      color: #fff;
      font-size: 1.1rem;
      text-align: center;
    }
    .tournaments-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .tournaments-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .tournament-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .tournament-card {
      background: #333;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px #0005;
      display: flex;
      flex-direction: column;
    }
    .tournament-card h4 {
      margin: 0 0 6px 0;
      font-size: 1rem;
      color: #00bfae;
    }
    .tournament-card p {
      margin: 0;
      font-size: 0.95rem;
      color: #fff;
    }
    .dropdown {
      margin: 18px 0;
      width: 100%;
      max-width: 600px;
    }
    .dropdown summary {
      background: #222;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 12px 18px;
      border-radius: 8px;
      cursor: pointer;
      outline: none;
      border: 2px solid #00bfae;
      margin-bottom: 6px;
      user-select: none;
    }
    .dropdown[open] summary {
      background: #00bfae;
      color: #222;
    }
    .dropdown-content {
      background: #333;
      color: #fff;
      padding: 14px 18px;
      border-radius: 0 0 8px 8px;
      font-size: 1rem;
      border-top: 1px solid #00bfae;
    }
    #adminMenuBtn { background: none; border: none; font-size: 2rem; cursor: pointer; margin-left: 12px; display: none; }
    #adminModal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000a; z-index: 9999; align-items: center; justify-content: center; }
    #adminModal.active { display: flex; }
    #adminModalContent { background: #222; color: #fff; border-radius: 16px; padding: 32px 24px; min-width: 320px; max-width: 90vw; box-shadow: 0 8px 32px #000b; position: relative; }
    #closeAdminModal { position: absolute; top: 12px; right: 16px; background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
    #adminModalContent button { padding: 10px; border-radius: 8px; border: none; font-size: 1rem; cursor: pointer; margin-bottom: 8px; width: 100%; max-width: 320px; }
    #banUserBtn { background: #c62828; color: #fff; }
    #unbanUserBtn { background: #388e3c; color: #fff; }
    #givePrizeBtn { background: #1976d2; color: #fff; }
    #disqualifyTeamBtn { background: #fbc02d; color: #222; }
    #editBracketBtn { background: #7b1fa2; color: #fff; }
    #adminResult { margin-top: 18px; color: #0f0; min-height: 24px; }
    .notification-btn {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      position: relative;
      margin-left: 8px;
      color: #fff;
    }
    .notification-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: #e53935;
      color: #fff;
      border-radius: 50%;
      font-size: 0.85rem;
      min-width: 20px;
      min-height: 20px;
      padding: 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid #222;
      box-sizing: border-box;
      z-index: 2;
    }
    #notificationPopup {
      right: 60px;
      left: auto;
      min-width: 280px;
      max-width: 340px;
      max-height: 400px;
      overflow-y: auto;
    }
    #notificationList {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .notification-item {
      background: #292929;
      border-radius: 8px;
      padding: 10px 12px;
      color: #fff;
      font-size: 0.98rem;
      box-shadow: 0 1px 4px #0004;
      word-break: break-word;
    }
    /* –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—ñ –¥–ª—è —Ñ–æ—Ä–º–∏ –∫–æ–º–∞–Ω–¥–∏ */
    .team-form { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 340px; margin-top: 8px; align-items: center; }
    .team-form label { font-size: 0.95rem; color: #bbb; margin-bottom: 2px; align-self: flex-start; }
    .team-form input[type="text"] { padding: 8px; border-radius: 6px; border: 1px solid #555; background: #222; color: #fff; font-size: 1rem; outline: none; width: 100%; }
    .team-form input[type="file"] { color: #fff; margin-bottom: 8px; align-self: flex-start; }
    .team-avatar-preview { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #00bfae; margin-bottom: 8px; background: #111; display: none; }
    .team-player-block { background: #292929; border-radius: 8px; padding: 10px 12px; margin-bottom: 8px; width: 100%; box-sizing: border-box; }
    .team-player-title { color: #00bfae; font-weight: bold; margin-bottom: 4px; font-size: 1rem; }
    .team-success-message { color: #00bfae; font-size: 1rem; margin: 10px 0 0 0; text-align: center; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="lang-btn" id="langBtn">üåê</div>
    <img id="avatar" class="avatar-small" src="avatar.jpg" alt="Avatar">
    <button id="notificationBtn" class="notification-btn" title="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è">
      üîî
      <span id="notificationBadge" class="notification-badge" style="display:none;">0</span>
    </button>
    <button id="adminMenuBtn" title="–ê–¥–º—ñ–Ω-–º–µ–Ω—é">üõ°Ô∏è</button>
    <div id="profilePopup" class="popup">
      <button class="register-btn" id="registerBtn" data-i18n="register">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
      <form class="profile-form" id="profileForm" style="display:none;">
        <label for="standoffNick" data-i18n="standoff_nick">–ù—ñ–∫ –≤ Standoff</label>
        <input type="text" id="standoffNick" name="standoffNick" required maxlength="32" autocomplete="off">
        <label for="standoffId" data-i18n="standoff_id">ID –≤ Standoff</label>
        <input type="text" id="standoffId" name="standoffId" required maxlength="32" autocomplete="off">
        <label for="tgUser" data-i18n="tg_user">Telegram</label>
        <input type="text" id="tgUser" name="tgUser" readonly>
        <button type="submit" class="done-btn" id="doneBtn" data-i18n="done">–ì–æ—Ç–æ–≤–æ</button>
      </form>
      <div class="player-profile" id="playerProfile">
        <div class="player-profile-title" data-i18n="profile">–ü—Ä–æ—Ñ—ñ–ª—å –≥—Ä–∞–≤—Ü—è</div>
        <div class="player-profile-row"><span data-i18n="standoff_nick">–ù—ñ–∫ –≤ Standoff</span>: <span id="profileNick"></span></div>
        <div class="player-profile-row"><span data-i18n="standoff_id">ID –≤ Standoff</span>: <span id="profileId"></span></div>
        <div class="player-profile-row"><span data-i18n="tg_user">Telegram</span>: <span id="profileTg"></span></div>
      </div>
      <button class="create-team-btn" id="createTeamBtn" style="display:none;" data-i18n="create_team">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>
      <div class="success-message" id="successMsg" style="display:none;" data-i18n="profile_saved">–ü—Ä–æ—Ñ—ñ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!</div>
      <form class="team-form" id="teamForm" style="display:none;">
        <label for="teamAvatar" data-i18n="team_avatar">–ê–≤–∞—Ç–∞—Ä–∫–∞ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="file" id="teamAvatar" accept="image/*">
        <img id="teamAvatarPreview" class="team-avatar-preview" src="#" alt="Team Avatar">
        <label for="teamTag" data-i18n="team_tag">–¢–µ–≥ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="text" id="teamTag" maxlength="12" required data-i18n-placeholder="team_tag_ph">
        <label for="teamName" data-i18n="team_name">–ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏</label>
        <input type="text" id="teamName" maxlength="32" required data-i18n-placeholder="team_name_ph">
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player1">–ì—Ä–∞–≤–µ—Ü—å 1 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="main1Id" required data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main1Nick" required data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="main1Tg" required data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player2">–ì—Ä–∞–≤–µ—Ü—å 2 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="main2Id" required data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main2Nick" required data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="main2Tg" required data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player3">–ì—Ä–∞–≤–µ—Ü—å 3 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="main3Id" required data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main3Nick" required data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="main3Tg" required data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player4">–ì—Ä–∞–≤–µ—Ü—å 4 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="main4Id" required data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main4Nick" required data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="main4Tg" required data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="main_player5">–ì—Ä–∞–≤–µ—Ü—å 5 (–æ—Å–Ω–æ–≤–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="main5Id" required data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="main5Nick" required data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="main5Tg" required data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="sub_player1">–ì—Ä–∞–≤–µ—Ü—å 6 (–∑–∞–ø–∞—Å–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="sub1Id" data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="sub1Nick" data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="sub1Tg" data-i18n-placeholder="player_tg_ph">
        </div>
        <div class="team-player-block">
          <div class="team-player-title" data-i18n="sub_player2">–ì—Ä–∞–≤–µ—Ü—å 7 (–∑–∞–ø–∞—Å–Ω–∏–π)</div>
          <input type="text" placeholder="ID –≤ Standoff 2" id="sub2Id" data-i18n-placeholder="player_id_ph">
          <input type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" id="sub2Nick" data-i18n-placeholder="player_nick_ph">
          <input type="text" placeholder="Telegram" id="sub2Tg" data-i18n-placeholder="player_tg_ph">
        </div>
        <button type="submit" class="done-btn" id="teamDoneBtn" data-i18n="team_done">–ì–æ—Ç–æ–≤–æ</button>
      </form>
      <div class="team-success-message" id="teamSuccessMsg" style="display:none;" data-i18n="team_created">–ö–æ–º–∞–Ω–¥—É —Å—Ç–≤–æ—Ä–µ–Ω–æ!</div>
    </div>
    <div id="langPopup" class="popup">
      <button class="lang-option" data-lang="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
      <button class="lang-option" data-lang="en">English</button>
      <button class="lang-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
      <button class="lang-option" data-lang="pl">Polski</button>
    </div>
    <div id="notificationPopup" class="popup" style="right:60px; min-width:280px;">
      <div style="font-weight:bold; color:#00bfae; margin-bottom:8px;" id="notificationTitle">–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</div>
      <div id="notificationList" style="width:100%;"></div>
      <button id="clearNotificationsBtn" class="done-btn" style="margin-top:10px;">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>
  </div>
  <div id="adminModal">
    <div id="adminModalContent">
      <button id="closeAdminModal">‚úñÔ∏è</button>
      <h2 id="adminMenuTitle" style="color:#00bfae; margin-top:0;">–ê–¥–º—ñ–Ω-–º–µ–Ω—é</h2>
      <div style="display:flex; flex-direction:column; gap:12px;">
        <button id="banUserBtn" data-i18n="ban_user">üö´ –ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
        <button id="unbanUserBtn" data-i18n="unban_user">‚úÖ –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
        <button id="givePrizeBtn" data-i18n="give_prize">üèÜ –í–∏–¥–∞—Ç–∏ –ø—Ä–∏–∑</button>
        <button id="disqualifyTeamBtn" data-i18n="disqualify_team">‚ùå –î–∏—Å–∫–≤–∞–ª—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>
        <button id="editBracketBtn" data-i18n="edit_bracket">üóÇÔ∏è –ú–æ–¥–µ—Ä—É–≤–∞—Ç–∏ —Å—ñ—Ç–∫—É</button>
      </div>
      <div id="adminResult"></div>
    </div>
  </div>
  <div class="main-section active" id="mainSection">
    <div class="news-section">
      <div class="news-title" data-i18n="news">–ù–æ–≤–∏–Ω–∏</div>
      <div class="news-list" id="newsList">
        <div class="news-card">
          <h4 data-i18n="news4title">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–æ–ª—å—Å—å–∫–æ—ó!</h4>
          <p data-i18n="news4desc">–¢–µ–ø–µ—Ä –≤ –Ω–∞—à–æ–º—É –¥–æ–¥–∞—Ç–∫—É –∑'—è–≤–∏–ª–∞—Å—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–æ–ª—å—Å—å–∫–æ—ó –º–æ–≤–∏.</p>
        </div>
        <div class="news-card">
          <h4 data-i18n="news5title">–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—É—Ä–Ω—ñ—Ä—ñ–≤!</h4>
          <p data-i18n="news5desc">–†–æ–∑–¥—ñ–ª "–¢—É—Ä–Ω—ñ—Ä–∏" –æ–Ω–æ–≤–ª–µ–Ω–æ!</p>
        </div>
      </div>
    </div>
    <div class="disciplines-section">
      <div class="disciplines-title" data-i18n="disciplines">–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏</div>
      <div class="disciplines-list">
        <div class="discipline-card">
          <img src="Standoff2.jpg" alt="Standoff 2" class="discipline-img">
          <div class="discipline-name">Standoff 2</div>
        </div>
      </div>
    </div>
    <div class="tournaments-section">
      <div class="tournaments-title" data-i18n="tournaments">–¢—É—Ä–Ω—ñ—Ä–∏</div>
      <div class="tournament-list" id="tournamentList">
        <div class="tournament-card">
          <h4>RFORZ Grad Prix Season 1</h4>
          <p data-i18n="tournament1desc">–ü–æ—á–∞—Ç–æ–∫: 1 –ª–∏–ø–Ω—è. –ü—Ä–∏–∑–æ–≤–∏–π —Ñ–æ–Ω–¥: 5000‚Ç¥</p>
        </div>
        <div class="tournament-card">
          <h4>Quiz Battle</h4>
          <p data-i18n="tournament2desc">–ü–æ—á–∞—Ç–æ–∫: 10 –ª–∏–ø–Ω—è. –ü—Ä–∏–∑–æ–≤–∏–π —Ñ–æ–Ω–¥: 2000‚Ç¥</p>
        </div>
      </div>
    </div>
  </div>
  <div class="rules-section" id="rulesSection">
    <details class="dropdown">
      <summary id="rule1x1Title"></summary>
      <div class="dropdown-content" id="rule1x1Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule2x2Title"></summary>
      <div class="dropdown-content" id="rule2x2Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule5x5Title"></summary>
      <div class="dropdown-content" id="rule5x5Content"></div>
    </details>
  </div>
  <div class="awards-section" id="awardsSection"></div>
  <div class="support-section" id="supportSection"></div>
  <div class="bottom-nav">
    <div class="nav-item active" id="navHome"><span>üè†</span><p data-i18n="home">–ì–æ–ª–æ–≤–Ω–∞</p></div>
    <div class="nav-item" id="navRules"><span>üìÑ</span><p data-i18n="rules">–ü—Ä–∞–≤–∏–ª–∞</p></div>
    <div class="nav-item" id="navAwards"><span>üèÜ</span><p data-i18n="awards">–ù–∞–≥–æ—Ä–æ–¥–∏</p></div>
    <div class="nav-item" id="navSupport"><span>ü§ñ</span><p data-i18n="support">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</p></div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const telegram = window.Telegram.WebApp;

    telegram.ready();
    telegram.expand();

    const avatarElement = document.getElementById('avatar');
    const profilePopup = document.getElementById('profilePopup');
    const registerBtn = document.getElementById('registerBtn');
    const profileForm = document.getElementById('profileForm');
    const doneBtn = document.getElementById('doneBtn');
    const profileSuccessMsg = document.getElementById('profileSuccessMsg');
    const playerProfile = document.getElementById('playerProfile');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const standoffNickInput = document.getElementById('standoffNick');
    const telegramUsernameInput = document.getElementById('telegramUsername');
    const displayNick = document.getElementById('displayNick');
    const displayTg = document.getElementById('displayTg');

    const langBtn = document.getElementById('langBtn');
    const langPopup = document.getElementById('langPopup');
    const langOptions = document.querySelectorAll('.lang-option');

    const navItems = document.querySelectorAll('.nav-item');
    const sections = document.querySelectorAll('.main-section, .rules-section, .awards-section, .support-section, .team-section');

    const teamForm = document.getElementById('teamForm');
    const teamAvatarInput = document.getElementById('teamAvatar');
    const teamAvatarPreview = document.getElementById('teamAvatarPreview');
    const teamSuccessMsg = document.getElementById('teamSuccessMsg');
    const createTeamBtn2 = document.getElementById('createTeamBtn2');

    const notificationBtn = document.getElementById('notificationBtn');
    const notificationPopup = document.getElementById('notificationPopup');
    const notificationBadge = document.getElementById('notificationBadge');
    const notificationList = document.getElementById('notificationList');

    const adminMenuBtn = document.getElementById('adminMenuBtn');
    const adminModal = document.getElementById('adminModal');
    const closeAdminModal = document.getElementById('closeAdminModal');
    const adminResult = document.getElementById('adminResult');

    const translations = {
      uk: {
        "register": "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å",
        "nick": "–ù—ñ–∫ —É Standoff 2:",
        "placeholder-nick": "–í–∞—à –Ω—ñ–∫",
        "telegram-username": "Telegram –Æ–∑–µ—Ä–Ω–µ–π–º:",
        "done": "–ì–æ—Ç–æ–≤–æ",
        "profile-saved": "–ü—Ä–æ—Ñ—ñ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!",
        "your-profile": "–í–∞—à –ü—Ä–æ—Ñ—ñ–ª—å:",
        "profile-nick": "–ù—ñ–∫:",
        "profile-telegram": "Telegram:",
        "edit-profile": "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å",
        "main-page": "–ì–æ–ª–æ–≤–Ω–∞ –°—Ç–æ—Ä—ñ–Ω–∫–∞",
        "rules": "–ü—Ä–∞–≤–∏–ª–∞",
        "awards": "–ù–∞–≥–æ—Ä–æ–¥–∏",
        "support": "–ü—ñ–¥—Ç—Ä–∏–º–∫–∞",
        "nav-main": "–ì–æ–ª–æ–≤–Ω–∞",
        "nav-rules": "–ü—Ä–∞–≤–∏–ª–∞",
        "nav-awards": "–ù–∞–≥–æ—Ä–æ–¥–∏",
        "nav-support": "–ü—ñ–¥—Ç—Ä–∏–º–∫–∞",
        "nav-team": "–ö–æ–º–∞–Ω–¥–∞",
        "news": "–ù–æ–≤–∏–Ω–∏",
        "disciplines": "–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏",
        "tournaments": "–¢—É—Ä–Ω—ñ—Ä–∏",
        "rule-1-title": "–ó–∞–≥–∞–ª—å–Ω—ñ –ø–æ–ª–æ–∂–µ–Ω–Ω—è",
        "rule-1-content": "<p>1.1. –¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç —î –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –∑–≤–µ–¥–µ–Ω–Ω—è–º –ø—Ä–∞–≤–∏–ª –¥–ª—è –≤—Å—ñ—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ —Ç—É—Ä–Ω—ñ—Ä—ñ–≤ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏.</p><p>1.2. –†–µ—î—Å—Ç—Ä—É—é—á–∏—Å—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ —Ç–∞ –±–µ—Ä—É—á–∏ —É—á–∞—Å—Ç—å —É —Ç—É—Ä–Ω—ñ—Ä–∞—Ö, –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—è –∑ —Ü–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.</p>",
        "rule-2-title": "–ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤",
        "rule-2-content": "<p>2.1. –£—á–∞—Å–Ω–∏–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Ç–∞ –≤–∑–∞—î–º–æ–ø–æ–≤–∞–≥–∏.</p><p>2.2. –ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ—ó –ª–µ–∫—Å–∏–∫–∏, –æ–±—Ä–∞–∑ —Ç–∞ –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ—ó.</p>",
        "rule-3-title": "–ß–µ—Å–Ω–∞ –≥—Ä–∞",
        "rule-3-content": "<p>3.1. –ö–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è (—á–∏—Ç—ñ–≤).</p><p>3.2. –ó–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ –Ω–µ–≥–∞–π–Ω–æ –¥–∏—Å–∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∞ —Ç–∞ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞.</p>",
        "awards-content": "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –Ω–∞–≥–æ—Ä–æ–¥–∏ —Ç–∞ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫—ñ–≤ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—É—Ç.",
        "support-content": "–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –Ω–∞—à–æ—ó —Å–ª—É–∂–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —á–µ—Ä–µ–∑ Telegram: @YourSupportUsername",
        "team-creation": "–°—Ç–≤–æ—Ä–∏—Ç–∏ –ö–æ–º–∞–Ω–¥—É",
        "team-name": "–ù–∞–∑–≤–∞ –ö–æ–º–∞–Ω–¥–∏:",
        "placeholder-team-name": "–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏",
        "team-tag": "–¢–µ–≥ –ö–æ–º–∞–Ω–¥–∏:",
        "placeholder-team-tag": "–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥ (–Ω–∞–ø—Ä. [TAG])",
        "team-avatar": "–ê–≤–∞—Ç–∞—Ä –ö–æ–º–∞–Ω–¥–∏:",
        "main-squad": "–û—Å–Ω–æ–≤–Ω–∏–π —Å–∫–ª–∞–¥ (5 –≥—Ä–∞–≤—Ü—ñ–≤)",
        "subs-squad": "–ó–∞–ø–∞—Å–Ω—ñ –≥—Ä–∞–≤—Ü—ñ (2 –≥—Ä–∞–≤—Ü—ñ, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)",
        "create-team": "–°—Ç–≤–æ—Ä–∏—Ç–∏ –ö–æ–º–∞–Ω–¥—É",
        "team-created-success": "–ö–æ–º–∞–Ω–¥–∞ —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞!",
        "create-new-team": "–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–æ–º–∞–Ω–¥—É",
        "admin-menu": "–ê–¥–º—ñ–Ω-–º–µ–Ω—é",
        "ban-user": "–ó–∞–±–∞–Ω–∏—Ç–∏ –≥—Ä–∞–≤—Ü—è",
        "unban-user": "–†–æ–∑–±–∞–Ω–∏—Ç–∏ –≥—Ä–∞–≤—Ü—è",
        "give-prize": "–í–∏–¥–∞—Ç–∏ –ø—Ä–∏–∑ –∫–æ–º–∞–Ω–¥—ñ",
        "disqualify-team": "–î–∏—Å–∫–≤–∞–ª—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É",
        "edit-bracket": "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å—ñ—Ç–∫—É",
        "notification-team-created-captain": "–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ '{teamName}' —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞! –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –≥—Ä–∞–≤—Ü—è–º: {invitedUsers}.",
        "notification-invite-player": "–í–∞—Å –∑–∞–ø—Ä–æ—Å–∏–ª–∏ –≤ –∫–æ–º–∞–Ω–¥—É '{teamName}' –≤—ñ–¥ @{captainUsername}. –ü—Ä–∏–π–Ω—è—Ç–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è?",
        "notification-invite-accepted": "@{playerUsername} –ø—Ä–∏–π–Ω—è–≤ –≤–∞—à–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏ '{teamName}'.",
        "notification-invite-declined": "@{playerUsername} –≤—ñ–¥—Ö–∏–ª–∏–≤ –≤–∞—à–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏ '{teamName}'.",
        "notification-team-full": "–í–∏ –¥–æ—Å—è–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ–º–∞–Ω–¥.",
        "notification-player-already-in-team": "–ì—Ä–∞–≤–µ—Ü—å –≤–∂–µ —î —É—á–∞—Å–Ω–∏–∫–æ–º —ñ–Ω—à–æ—ó –∫–æ–º–∞–Ω–¥–∏.",
        "notification-invite-sent": "–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!",
        "notification-invite-already-pending": "–í–∏ –≤–∂–µ –º–∞—î—Ç–µ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è –¥–æ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏.",
        "notification-self-invite": "–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç–∏ —Å–µ–±–µ –¥–æ –∫–æ–º–∞–Ω–¥–∏.",
        "notification-player-not-found": "–ì—Ä–∞–≤–µ—Ü—å –∑ —Ç–∞–∫–∏–º Telegram —é–∑–µ—Ä–Ω–µ–π–º–æ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π.",
        "notification-invalid-telegram-username": "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω–∏–π Telegram —é–∑–µ—Ä–Ω–µ–π–º (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ @, –º—ñ–Ω—ñ–º—É–º 5 —Å–∏–º–≤–æ–ª—ñ–≤)."
      },
      en: {
        "register": "Register",
        "nick": "Standoff 2 Nick:",
        "placeholder-nick": "Your Nickname",
        "telegram-username": "Telegram Username:",
        "done": "Done",
        "profile-saved": "Profile saved!",
        "your-profile": "Your Profile:",
        "profile-nick": "Nick:",
        "profile-telegram": "Telegram:",
        "edit-profile": "Edit profile",
        "main-page": "Main Page",
        "rules": "Rules",
        "awards": "Awards",
        "support": "Support",
        "nav-main": "Main",
        "nav-rules": "Rules",
        "nav-awards": "Awards",
        "nav-support": "Support",
        "nav-team": "Team",
        "news": "News",
        "disciplines": "Disciplines",
        "tournaments": "Tournaments",
        "rule-1-title": "General Provisions",
        "rule-1-content": "<p>1.1. This document is the official set of rules for all tournament participants and platform users.</p><p>1.2. By registering on the platform and participating in tournaments, you agree to these rules.</p>",
        "rule-2-title": "Player Conduct",
        "rule-2-content": "<p>2.1. Participants must adhere to sportsmanship and mutual respect.</p><p>2.2. Use of offensive language, insults, and discrimination is prohibited.</p>",
        "rule-3-title": "Fair Play",
        "rule-3-content": "<p>3.1. The use of any third-party software (cheats) is strictly prohibited.</p><p>3.2. Violation of this rule will result in immediate disqualification and banning of the team.</p>",
        "awards-content": "Information about awards and participant achievements will be available here.",
        "support-content": "If you have any questions, please contact our support team via Telegram: @YourSupportUsername",
        "team-creation": "Create Team",
        "team-name": "Team Name:",
        "placeholder-team-name": "Enter team name",
        "team-tag": "Team Tag:",
        "placeholder-team-tag": "Enter tag (e.g., [TAG])",
        "team-avatar": "Team Avatar:",
        "main-squad": "Main Squad (5 players)",
        "subs-squad": "Substitute Players (2 players, optional)",
        "create-team": "Create Team",
        "team-created-success": "Team successfully created!",
        "create-new-team": "Create New Team",
        "admin-menu": "Admin Menu",
        "ban-user": "Ban Player",
        "unban-user": "Unban Player",
        "give-prize": "Give Prize to Team",
        "disqualify-team": "Disqualify Team",
        "edit-bracket": "Edit Bracket",
        "notification-team-created-captain": "Your team '{teamName}' has been successfully created! Invitations sent to players: {invitedUsers}.",
        "notification-invite-player": "You have been invited to join team '{teamName}' by @{captainUsername}. Accept invitation?",
        "notification-invite-accepted": "@{playerUsername} accepted your invitation to team '{teamName}'.",
        "notification-invite-declined": "@{playerUsername} declined your invitation to team '{teamName}'.",
        "notification-team-full": "You have reached the maximum number of teams.",
        "notification-player-already-in-team": "Player is already a member of another team.",
        "notification-invite-sent": "Invitation sent!",
        "notification-invite-already-pending": "You already have a pending invitation for this team.",
        "notification-self-invite": "You cannot invite yourself to the team.",
        "notification-player-not-found": "Player with this Telegram username not found.",
        "notification-invalid-telegram-username": "Please enter a valid Telegram username (starts with @, min 5 characters)."
      }
    };

    let currentLang = localStorage.getItem('lang') || 'uk';

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('lang', lang);
      translatePage();
    }

    function translatePage() {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[currentLang] && translations[currentLang][key]) {
          element.innerHTML = translations[currentLang][key];
        }
      });
    }

    // Function to add notification
    function addNotification(type, data) {
      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      const timestamp = new Date().toLocaleString();
      let message = '';

      switch (type) {
        case 'team_created_captain':
          message = translations[currentLang]['notification-team-created-captain']
            .replace('{teamName}', data.teamName)
            .replace('{invitedUsers}', data.invitedUsers);
          break;
        // Add other notification types if needed for local display
        default:
          message = `Unknown notification type: ${type}`;
      }

      notifications.unshift({ message, timestamp }); // Add to the beginning
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
      updateNotificationBadge();
    }

    // Function to render notifications
    function renderNotifications() {
      notificationList.innerHTML = '';
      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      if (notifications.length === 0) {
        notificationList.innerHTML = `<div class="notification-item" data-i18n="no-notifications">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å.</div>`;
      } else {
        notifications.forEach(notification => {
          const notificationItem = document.createElement('div');
          notificationItem.classList.add('notification-item');
          notificationItem.innerHTML = `${notification.message}<br><small style="color:#aaa;">${notification.timestamp}</small>`;
          notificationList.appendChild(notificationItem);
        });
      }
      translatePage(); // Translate newly added notification text
    }

    // Update notification badge count
    function updateNotificationBadge() {
      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      if (notifications.length > 0) {
        notificationBadge.textContent = notifications.length;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
    }


    telegram.onEvent('main_button_pressed', function() {
      Telegram.WebApp.close();
    });

    telegram.MainButton.setText('–ó–∞–∫—Ä–∏—Ç–∏');
    telegram.MainButton.show();

    avatarElement.addEventListener('click', () => {
      profilePopup.classList.toggle('active');
      langPopup.classList.remove('active'); // Close lang popup if open
      notificationPopup.classList.remove('active'); // Close notification popup if open
      loadProfile();
    });

    langBtn.addEventListener('click', () => {
      langPopup.classList.toggle('active');
      profilePopup.classList.remove('active'); // Close profile popup if open
      notificationPopup.classList.remove('active'); // Close notification popup if open
    });

    langOptions.forEach(option => {
      option.addEventListener('click', () => {
        setLanguage(option.dataset.lang);
        langPopup.classList.remove('active');
      });
    });

    notificationBtn.addEventListener('click', () => {
      notificationPopup.classList.toggle('active');
      profilePopup.classList.remove('active'); // Close profile popup if open
      langPopup.classList.remove('active'); // Close lang popup if open
      renderNotifications(); // Render notifications when popup is opened
    });

    adminMenuBtn.addEventListener('click', () => {
      adminModal.classList.add('active');
    });

    closeAdminModal.addEventListener('click', () => {
      adminModal.classList.remove('active');
    });

    // Admin action buttons (for demonstration)
    document.getElementById('banUserBtn').addEventListener('click', () => {
      adminResult.textContent = 'User banned (simulated).';
    });
    document.getElementById('unbanUserBtn').addEventListener('click', () => {
      adminResult.textContent = 'User unbanned (simulated).';
    });
    document.getElementById('givePrizeBtn').addEventListener('click', () => {
      adminResult.textContent = 'Prize given (simulated).';
    });
    document.getElementById('disqualifyTeamBtn').addEventListener('click', () => {
      adminResult.textContent = 'Team disqualified (simulated).';
    });
    document.getElementById('editBracketBtn').addEventListener('click', () => {
      adminResult.textContent = 'Bracket edited (simulated).';
    });


    function loadProfile() {
      const userId = telegram.initDataUnsafe.user?.id;
      const userNick = telegram.initDataUnsafe.user?.username;

      if (userId) {
        telegramUsernameInput.value = `@${userNick || 'N/A'}`; // Set Telegram username

        const savedNick = localStorage.getItem(`nick_${userId}`);
        const savedAvatar = localStorage.getItem(`avatar_${userId}`);

        if (savedNick) {
          standoffNickInput.value = savedNick;
          displayNick.textContent = savedNick;
          displayTg.textContent = `@${userNick || 'N/A'}`;
          registerBtn.style.display = 'none';
          profileForm.style.display = 'none';
          playerProfile.style.display = 'block';
        } else {
          registerBtn.style.display = 'block';
          profileForm.style.display = 'none';
          playerProfile.style.display = 'none';
        }

        if (savedAvatar) {
          avatarElement.src = savedAvatar;
        } else if (telegram.initDataUnsafe.user?.photo_url) {
          avatarElement.src = telegram.initDataUnsafe.user.photo_url;
        } else {
          avatarElement.src = 'avatar.jpg'; // Default avatar
        }
      } else {
        // Handle cases where user ID is not available (e.g., debugging outside Telegram WebApp)
        registerBtn.style.display = 'block';
        profileForm.style.display = 'none';
        playerProfile.style.display = 'none';
        telegramUsernameInput.value = '@debuguser';
        avatarElement.src = 'avatar.jpg';
      }
    }

    registerBtn.addEventListener('click', () => {
      registerBtn.style.display = 'none';
      profileForm.style.display = 'flex';
      profileSuccessMsg.style.display = 'none';
      playerProfile.style.display = 'none';
    });

    doneBtn.addEventListener('click', () => {
      const userId = telegram.initDataUnsafe.user?.id;
      if (userId) {
        const nick = standoffNickInput.value;
        localStorage.setItem(`nick_${userId}`, nick);
        displayNick.textContent = nick;
        displayTg.textContent = telegramUsernameInput.value;
        profileForm.style.display = 'none';
        profileSuccessMsg.style.display = 'block';
        playerProfile.style.display = 'block';
      }
    });

    editProfileBtn.addEventListener('click', () => {
      registerBtn.style.display = 'none';
      profileForm.style.display = 'flex';
      profileSuccessMsg.style.display = 'none';
      playerProfile.style.display = 'none';
    });

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const targetSectionId = item.dataset.section + 'Section';

        navItems.forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');

        sections.forEach(section => {
          if (section.id === targetSectionId) {
            section.classList.add('active');
          } else {
            section.classList.remove('active');
          }
        });
        profilePopup.classList.remove('active'); // Close popups when navigating
        langPopup.classList.remove('active');
        notificationPopup.classList.remove('active');
      });
    });

    // Team creation form
    teamAvatarInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          teamAvatarPreview.src = e.target.result;
          teamAvatarPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    teamForm.addEventListener('submit', async (event) => {
      event.preventDefault();

      const teamName = document.getElementById('teamName').value;
      const teamTag = document.getElementById('teamTag').value;
      const captainUsername = telegram.initDataUnsafe.user?.username || 'unknown';

      const players = [];
      for (let i = 1; i <= 5; i++) {
        const id = document.getElementById(`main${i}Id`).value;
        const nick = document.getElementById(`main${i}Nick`).value;
        const tg = document.getElementById(`main${i}Tg`).value;
        if (id && nick) {
          players.push({ id, nick, tg });
        }
      }
      for (let i = 1; i <= 2; i++) {
        const id = document.getElementById(`sub${i}Id`).value;
        const nick = document.getElementById(`sub${i}Nick`).value;
        const tg = document.getElementById(`sub${i}Tg`).value;
        if (id && nick) {
          players.push({ id, nick, tg });
        }
      }

      const teamData = {
        team_name: teamName,
        team_tag: teamTag,
        captain_username: captainUsername,
        players: players.filter(p => p.tg).map(p => p.tg)
      };

      try {
        const response = await fetch('/api/create_team', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(teamData),
        });

        const result = await response.json();

        if (result.success) {
          const invitedPlayers = teamData.players.length > 0
            ? teamData.players.map(username => `@${username}`).join(', ')
            : '–Ω–µ–º–∞—î';

          addNotification('team_created_captain', {
            teamName: teamName,
            invitedUsers: invitedPlayers
          });

          document.getElementById('teamForm').style.display = "none";
          document.getElementById('teamSuccessMsg').style.display = "block";
          document.getElementById('createTeamBtn2').style.display = "block";
        } else {
          alert(`–ü–æ–º–∏–ª–∫–∞: ${result.message}`);
        }
      } catch (error) {
        console.error('Error creating team:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
      }
    });

    createTeamBtn2.addEventListener('click', () => {
      teamForm.reset();
      teamAvatarPreview.style.display = 'none';
      teamForm.style.display = 'flex';
      teamSuccessMsg.style.display = 'none';
      createTeamBtn2.style.display = 'none';
    });

    // Initial calls
    setLanguage(currentLang);
    loadProfile();
    updateNotificationBadge(); // Initial badge update
  </script>
</body>
</html>
