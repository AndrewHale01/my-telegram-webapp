<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Telegram WebApp</title>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZN665FNYF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TZN665FNYF');
  </script>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      padding-bottom: 60px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      position: relative;
    }
    .lang-btn {
      font-size: 1.5rem;
      cursor: pointer;
      margin-right: 0px;
    }
    .avatar-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #00bfae;
      cursor: pointer;
      object-fit: cover;
      background: #111;
      transition: box-shadow 0.2s;
    }
    .avatar-small:hover {
      box-shadow: 0 0 0 4px #00bfae55;
    }
    .popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 0;
      background: #333;
      padding: 24px 20px 20px 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 10;
      flex-direction: column;
      min-width: 260px;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    .popup.active {
      display: flex;
    }
    .register-btn, .done-btn, .create-team-btn {
      background: #2196f3;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
      transition: background 0.2s;
      width: 100%;
      max-width: 220px;
    }
    .register-btn:hover, .done-btn:hover, .create-team-btn:hover {
      background: #1976d2;
    }
    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
    }
    .profile-form label {
      font-size: 0.95rem;
      color: #bbb;
      margin-bottom: 2px;
    }
    .profile-form input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      width: 100%;
    }
    .profile-form input[readonly] {
      background: #222;
      color: #aaa;
      border: 1px solid #444;
    }
    .success-message {
      color: #00bfae;
      font-size: 1rem;
      margin: 10px 0 0 0;
      text-align: center;
    }
    .player-profile {
      width: 100%;
      max-width: 220px;
      margin-top: 8px;
      margin-bottom: 8px;
      background: #222;
      border-radius: 10px;
      padding: 12px 14px;
      color: #fff;
      font-size: 1rem;
      box-sizing: border-box;
      display: none;
    }
    .player-profile-title {
      margin-bottom: 8px;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.05rem;
    }
    .player-profile-row {
      margin-bottom: 4px;
      word-break: break-word;
    }
    .lang-option {
      background: #444;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 5px;
    }
    .lang-option:hover {
      background: #555;
    }
    #langPopup {
      left: 0;
      right: auto;
    }
    .main-section, .rules-section, .awards-section, .support-section {
      display: none;
      padding: 0 16px;
    }
    .main-section.active, .rules-section.active, .awards-section.active, .support-section.active {
      display: block;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #333;
      padding: 8px 0;
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .nav-item span {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active, .nav-item:hover {
      color: #00bfae;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95);}
      to { opacity: 1; transform: scale(1);}
    }
    .news-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .news-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .news-list {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding-bottom: 8px;
      scrollbar-width: thin;
    }
    .news-card {
      min-width: 220px;
      background: #333;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px #0005;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .news-card p {
      margin: 0;
      font-size: 0.95rem;
      color: #fff;
      word-break: break-word;
      white-space: normal;
      overflow-wrap: break-word;
      max-width: 100%;
    }
    .news-card h4 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      color: #00bfae;
    }
    .disciplines-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .disciplines-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .disciplines-list {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    .discipline-card {
      background: #333;
      border-radius: 12px;
      padding: 10px 14px;
      box-shadow: 0 2px 8px #0005;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 320px;
      max-width: 320px;
      border: 4px solid #00bfae;
    }
    .discipline-img {
      width: 320px;
      height: 320px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 8px;
      background: #222;
      border: none;
      display: block;
    }
    .discipline-name {
      color: #fff;
      font-size: 1.1rem;
      text-align: center;
    }
    .tournaments-section {
      margin: 0 0 24px 0;
      padding: 0 16px;
    }
    .tournaments-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      color: #00bfae;
      letter-spacing: 0.5px;
    }
    .tournament-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .tournament-card {
      background: #333;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px #0005;
      display: flex;
      flex-direction: column;
    }
    .tournament-card h4 {
      margin: 0 0 6px 0;
      font-size: 1rem;
      color: #00bfae;
    }
    .tournament-card p {
      margin: 0;
      font-size: 0.95rem;
      color: #fff;
    }
    .dropdown {
      margin: 18px 0;
      width: 100%;
      max-width: 600px;
    }
    .dropdown summary {
      background: #222;
      color: #00bfae;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 12px 18px;
      border-radius: 8px;
      cursor: pointer;
      outline: none;
      border: 2px solid #00bfae;
      margin-bottom: 6px;
      user-select: none;
    }
    .dropdown[open] summary {
      background: #00bfae;
      color: #222;
    }
    .dropdown-content {
      background: #333;
      color: #fff;
      padding: 14px 18px;
      border-radius: 0 0 8px 8px;
      font-size: 1rem;
      border-top: 1px solid #00bfae;
    }
    #adminMenuBtn { background: none; border: none; font-size: 2rem; cursor: pointer; margin-left: 12px; display: none; }
    #adminModal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000a; z-index: 9999; align-items: center; justify-content: center; }
    #adminModal.active { display: flex; }
    #adminModalContent { background: #222; color: #fff; border-radius: 16px; padding: 32px 24px; min-width: 320px; max-width: 90vw; box-shadow: 0 8px 32px #000b; position: relative; }
    #closeAdminModal { position: absolute; top: 12px; right: 16px; background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
    #adminModalContent button { padding: 10px; border-radius: 8px; border: none; font-size: 1rem; cursor: pointer; margin-bottom: 8px; width: 100%; max-width: 320px; }
    #banUserBtn { background: #c62828; color: #fff; }
    #unbanUserBtn { background: #388e3c; color: #fff; }
    #givePrizeBtn { background: #1976d2; color: #fff; }
    #disqualifyTeamBtn { background: #fbc02d; color: #222; }
    #editBracketBtn { background: #7b1fa2; color: #fff; }
    #adminResult { margin-top: 18px; color: #0f0; min-height: 24px; }
    .notification-btn {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      position: relative;
      margin-left: 8px;
      color: #fff;
    }
    .notification-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: #e53935;
      color: #fff;
      border-radius: 50%;
      font-size: 0.85rem;
      min-width: 20px;
      min-height: 20px;
      padding: 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid #222;
      box-sizing: border-box;
      z-index: 2;
    }
    #notificationPopup {
      right: 60px;
      left: auto;
      min-width: 280px;
      max-width: 340px;
      max-height: 400px;
      overflow-y: auto;
    }
    #notificationList {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .notification-item {
      background: #292929;
      border-radius: 8px;
      padding: 10px 12px;
      color: #fff;
      font-size: 0.98rem;
      box-shadow: 0 1px 4px #0004;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="lang-btn" id="langBtn">🌐</div>
    <img id="avatar" class="avatar-small" src="avatar.jpg" alt="Avatar">
    <button id="notificationBtn" class="notification-btn" title="Сповіщення">
      🔔
      <span id="notificationBadge" class="notification-badge" style="display:none;">0</span>
    </button>
    <button id="adminMenuBtn" title="Адмін-меню">🛡️</button>
    <div id="profilePopup" class="popup">
      <button class="register-btn" id="registerBtn" data-i18n="register">Зареєструватись</button>
      <form class="profile-form" id="profileForm" style="display:none;">
        <label for="standoffNick" data-i18n="standoff_nick">Нік в Standoff</label>
        <input type="text" id="standoffNick" name="standoffNick" required maxlength="32" autocomplete="off">
        <label for="standoffId" data-i18n="standoff_id">ID в Standoff</label>
        <input type="text" id="standoffId" name="standoffId" required maxlength="32" autocomplete="off">
        <label for="tgUser" data-i18n="tg_user">Telegram</label>
        <input type="text" id="tgUser" name="tgUser" readonly>
        <button type="submit" class="done-btn" id="doneBtn" data-i18n="done">Готово</button>
      </form>
      <div class="player-profile" id="playerProfile">
        <div class="player-profile-title" data-i18n="profile">Профіль гравця</div>
        <div class="player-profile-row"><span data-i18n="standoff_nick">Нік в Standoff</span>: <span id="profileNick"></span></div>
        <div class="player-profile-row"><span data-i18n="standoff_id">ID в Standoff</span>: <span id="profileId"></span></div>
        <div class="player-profile-row"><span data-i18n="tg_user">Telegram</span>: <span id="profileTg"></span></div>
      </div>
      <button class="create-team-btn" id="createTeamBtn" style="display:none;" data-i18n="create_team">Створити команду</button>
      <div class="success-message" id="successMsg" style="display:none;" data-i18n="profile_saved">Профіль збережено!</div>
    </div>
    <div id="langPopup" class="popup">
      <button class="lang-option" data-lang="uk">Українська</button>
      <button class="lang-option" data-lang="en">English</button>
      <button class="lang-option" data-lang="ru">Русский</button>
      <button class="lang-option" data-lang="pl">Polski</button>
    </div>
    <div id="notificationPopup" class="popup" style="right:60px; min-width:280px;">
      <div style="font-weight:bold; color:#00bfae; margin-bottom:8px;" id="notificationTitle">Сповіщення</div>
      <div id="notificationList" style="width:100%;"></div>
      <button id="clearNotificationsBtn" class="done-btn" style="margin-top:10px;">Очистити</button>
    </div>
  </div>

  <div id="adminModal">
    <div id="adminModalContent">
      <button id="closeAdminModal">✖️</button>
      <h2 id="adminMenuTitle" style="color:#00bfae; margin-top:0;">Адмін-меню</h2>
      <div style="display:flex; flex-direction:column; gap:12px;">
        <button id="banUserBtn" data-i18n="ban_user">🚫 Заблокувати користувача</button>
        <button id="unbanUserBtn" data-i18n="unban_user">✅ Розблокувати користувача</button>
        <button id="givePrizeBtn" data-i18n="give_prize">🏆 Видати приз</button>
        <button id="disqualifyTeamBtn" data-i18n="disqualify_team">❌ Дискваліфікувати команду</button>
        <button id="editBracketBtn" data-i18n="edit_bracket">🗂️ Модерувати сітку</button>
      </div>
      <div id="adminResult"></div>
    </div>
  </div>

  <div class="main-section active" id="mainSection">
    <div class="news-section">
      <div class="news-title" data-i18n="news">Новини</div>
      <div class="news-list" id="newsList">
        <div class="news-card">
          <h4 data-i18n="news4title">Підтримка польської!</h4>
          <p data-i18n="news4desc">Тепер в нашому додатку з'явилася підтримка польської мови.</p>
        </div>
        <div class="news-card">
          <h4 data-i18n="news5title">Оновлення турнірів!</h4>
          <p data-i18n="news5desc">Розділ "Турніри" оновлено!</p>
        </div>
      </div>
    </div>
    <div class="disciplines-section">
      <div class="disciplines-title" data-i18n="disciplines">Дисципліни</div>
      <div class="disciplines-list">
        <div class="discipline-card">
          <img src="Standoff2.jpg" alt="Standoff 2" class="discipline-img">
          <div class="discipline-name">Standoff 2</div>
        </div>
      </div>
    </div>
    <div class="tournaments-section">
      <div class="tournaments-title" data-i18n="tournaments">Турніри</div>
      <div class="tournament-list" id="tournamentList">
        <div class="tournament-card">
          <h4>RFORZ Grad Prix Season 1</h4>
          <p data-i18n="tournament1desc">Початок: 1 липня. Призовий фонд: 5000₴</p>
        </div>
        <div class="tournament-card">
          <h4>Quiz Battle</h4>
          <p data-i18n="tournament2desc">Початок: 10 липня. Призовий фонд: 2000₴</p>
        </div>
      </div>
    </div>
  </div>

  <div class="rules-section" id="rulesSection">
    <details class="dropdown">
      <summary id="rule1x1Title"></summary>
      <div class="dropdown-content" id="rule1x1Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule2x2Title"></summary>
      <div class="dropdown-content" id="rule2x2Content"></div>
    </details>
    <details class="dropdown">
      <summary id="rule5x5Title"></summary>
      <div class="dropdown-content" id="rule5x5Content"></div>
    </details>
  </div>

  <div class="awards-section" id="awardsSection"></div>
  <div class="support-section" id="supportSection"></div>

  <div class="bottom-nav">
    <div class="nav-item active" id="navHome"><span>🏠</span><p data-i18n="home">Головна</p></div>
    <div class="nav-item" id="navRules"><span>📄</span><p data-i18n="rules">Правила</p></div>
    <div class="nav-item" id="navAwards"><span>🏆</span><p data-i18n="awards">Нагороди</p></div>
    <div class="nav-item" id="navSupport"><span>🤖</span><p data-i18n="support">Підтримка</p></div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const ADMIN_IDS = [5806282517];

    const notificationTranslations = {
      uk: {
        invite: "Вас запросили в команду.",
        joined: "{user} вступив в команду.",
        prize: "Ви отримали приз за участь в турнірі.",
        banned: "Ваш аккаунт було заблоковано за використання стороннього ПЗ.",
        unbanned: "Ваш аккаунт розблоковано.",
        disqualified: "Ваша команда дискваліфікована з турніру за порушення правил.",
        title: "Сповіщення",
        clear: "Очистити",
        empty: "Немає сповіщень"
      },
      en: {
        invite: "You have been invited to a team.",
        joined: "{user} joined the team.",
        prize: "You received a prize for participating in the tournament.",
        banned: "Your account has been banned for using third-party software.",
        unbanned: "Your account has been unbanned.",
        disqualified: "Your team has been disqualified from the tournament for rule violation.",
        title: "Notifications",
        clear: "Clear",
        empty: "No notifications"
      },
      ru: {
        invite: "Вас пригласили в команду.",
        joined: "{user} вступил в команду.",
        prize: "Вы получили приз за участие в турнире.",
        banned: "Ваш аккаунт был заблокирован за использование стороннего ПО.",
        unbanned: "Ваш аккаунт разблокирован.",
        disqualified: "Ваша команда дисквалифицирована за нарушение правил.",
        title: "Уведомления",
        clear: "Очистить",
        empty: "Нет уведомлений"
      },
      pl: {
        invite: "Zostałeś zaproszony do drużyny.",
        joined: "{user} dołączył do drużyny.",
        prize: "Otrzymałeś nagrodę za udział w turnieju.",
        banned: "Twoje konto zostało zablokowane za używanie niedozwolonego oprogramowania.",
        unbanned: "Twoje konto zostało odblokowane.",
        disqualified: "Twoja drużyna została zdyskwalifikowana za złamanie zasad.",
        title: "Powiadomienia",
        clear: "Wyczyść",
        empty: "Brak powiadomień"
      }
    };
    let currentLang = localStorage.getItem('lang') || 'uk';
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationPopup = document.getElementById('notificationPopup');
    const notificationBadge = document.getElementById('notificationBadge');
    const notificationList = document.getElementById('notificationList');
    const clearNotificationsBtn = document.getElementById('clearNotificationsBtn');
    const notificationTitle = document.getElementById('notificationTitle');
    function getNotifications() {
      return JSON.parse(localStorage.getItem('notifications') || '[]');
    }
    function setNotifications(arr) {
      localStorage.setItem('notifications', JSON.stringify(arr));
    }
    function updateNotificationBadge() {
      const arr = getNotifications();
      if (arr.length > 0) {
        notificationBadge.textContent = arr.length;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
    }
    function renderNotifications() {
      const arr = getNotifications();
      notificationList.innerHTML = '';
      if (arr.length === 0) {
        notificationList.innerHTML = `<div style="color:#bbb; text-align:center;">${notificationTranslations[currentLang].empty}</div>`;
      } else {
        arr.forEach(n => {
          let text = notificationTranslations[currentLang][n.type] || n.text || "";
          if (n.type === 'joined' && n.user) {
            text = notificationTranslations[currentLang].joined.replace('{user}', n.user);
          }
          notificationList.innerHTML += `<div class="notification-item">${text}</div>`;
        });
      }
      updateNotificationBadge();
    }
    function addNotification(type, data = {}) {
      let text = notificationTranslations[currentLang][type] || '';
      if (type === 'joined' && data.user) {
        text = notificationTranslations[currentLang].joined.replace('{user}', data.user);
      }
      const arr = getNotifications();
      arr.unshift({ type, text, ...data, ts: Date.now() });
      setNotifications(arr);
      updateNotificationBadge();
    }
    notificationBtn.addEventListener('click', () => {
      notificationPopup.classList.toggle('active');
      renderNotifications();
      notificationTitle.textContent = notificationTranslations[currentLang].title;
      clearNotificationsBtn.textContent = notificationTranslations[currentLang].clear;
    });
    clearNotificationsBtn.addEventListener('click', () => {
      setNotifications([]);
      renderNotifications();
    });
    document.addEventListener("click", function(e) {
      if (!notificationPopup.contains(e.target) && e.target !== notificationBtn) {
        notificationPopup.classList.remove("active");
      }
    });
    window.addEventListener("DOMContentLoaded", () => {
      updateNotificationBadge();
    });

    window.addEventListener("DOMContentLoaded", () => {
      const tg = window.Telegram.WebApp;
      const userId = tg.initDataUnsafe?.user?.id;
      if (ADMIN_IDS.includes(userId)) {
        document.getElementById('adminMenuBtn').style.display = 'inline-block';
      }
    });

    document.getElementById('adminMenuBtn').onclick = function() {
      document.getElementById('adminModal').classList.add('active');
    };
    document.getElementById('closeAdminModal').onclick = function() {
      document.getElementById('adminModal').classList.remove('active');
      document.getElementById('adminResult').innerText = '';
    };
    document.getElementById('adminModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.remove('active');
        document.getElementById('adminResult').innerText = '';
      }
    });

    document.getElementById('banUserBtn').onclick = function() {
      const userId = prompt("Введіть ID користувача для бану:");
      if (userId) {
        document.getElementById('adminResult').innerText = `Користувач ${userId} заблокований (демо).`;
        addNotification('banned');
      }
    };
    document.getElementById('unbanUserBtn').onclick = function() {
      const userId = prompt("Введіть ID користувача для розбану:");
      if (userId) {
        document.getElementById('adminResult').innerText = `Користувач ${userId} розблокований (демо).`;
        addNotification('unbanned');
      }
    };
    document.getElementById('givePrizeBtn').onclick = function() {
      const userId = prompt("Введіть ID користувача для призу:");
      if (userId) {
        document.getElementById('adminResult').innerText = `Приз видано користувачу ${userId} (демо).`;
        addNotification('prize');
      }
    };
    document.getElementById('disqualifyTeamBtn').onclick = function() {
      const teamId = prompt("Введіть ID команди для дискваліфікації:");
      if (teamId) {
        document.getElementById('adminResult').innerText = `Команда ${teamId} дискваліфікована (демо).`;
        addNotification('disqualified');
      }
    };
    document.getElementById('editBracketBtn').onclick = function() {
      document.getElementById('adminResult').innerText = `Модерація турнірної сітки (демо).`;
    };

    const tg = window.Telegram.WebApp;

    const avatar = document.getElementById("avatar");
    const profilePopup = document.getElementById("profilePopup");
    const langBtn = document.getElementById("langBtn");
    const langPopup = document.getElementById("langPopup");
    const langOptions = document.querySelectorAll(".lang-option");

    const registerBtn = document.getElementById("registerBtn");
    const profileForm = document.getElementById("profileForm");
    const doneBtn = document.getElementById("doneBtn");
    const createTeamBtn = document.getElementById("createTeamBtn");
    const successMsg = document.getElementById("successMsg");
    const tgUserInput = document.getElementById("tgUser");
    const standoffNickInput = document.getElementById("standoffNick");
    const standoffIdInput = document.getElementById("standoffId");
    const playerProfile = document.getElementById("playerProfile");
    const profileNick = document.getElementById("profileNick");
    const profileId = document.getElementById("profileId");
    const profileTg = document.getElementById("profileTg");

    const navHome = document.getElementById("navHome");
    const navRules = document.getElementById("navRules");
    const navAwards = document.getElementById("navAwards");
    const navSupport = document.getElementById("navSupport");
    const mainSection = document.getElementById("mainSection");
    const rulesSection = document.getElementById("rulesSection");
    const awardsSection = document.getElementById("awardsSection");
    const supportSection = document.getElementById("supportSection");

    const translations = {
      // ... (весь translations як у твоєму коді, не скорочую для повноти)
      // Додавай тут всі переклади, як у твоєму коді
    };

    function translateRules(lang) {
      document.getElementById('rule1x1Title').innerHTML = translations[lang].rule1x1_title;
      document.getElementById('rule1x1Content').innerHTML = translations[lang].rule1x1;
      document.getElementById('rule2x2Title').innerHTML = translations[lang].rule2x2_title;
      document.getElementById('rule2x2Content').innerHTML = translations[lang].rule2x2;
      document.getElementById('rule5x5Title').innerHTML = translations[lang].rule5x5_title;
      document.getElementById('rule5x5Content').innerHTML = translations[lang].rule5x5;
    }

    function applyTranslations(lang) {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.dataset.i18n;
        let text = translations[lang][key];
        if (text) {
          el.innerHTML = text.replace(/\n/g, "<br>");
        }
      });
      if (document.getElementById('adminMenuTitle')) {
        document.getElementById('adminMenuTitle').innerHTML = translations[lang].admin_menu;
      }
      notificationTitle.textContent = notificationTranslations[lang].title;
      clearNotificationsBtn.textContent = notificationTranslations[lang].clear;
      localStorage.setItem('lang', lang);
      translateRules(lang);
      renderNotifications();
    }

    navHome.addEventListener('click', () => showSection('main'));
    navRules.addEventListener('click', () => showSection('rules'));
    navAwards.addEventListener('click', () => showSection('awards'));
    navSupport.addEventListener('click', () => showSection('support'));

    function showSection(section) {
      mainSection.classList.remove('active');
      rulesSection.classList.remove('active');
      awardsSection.classList.remove('active');
      supportSection.classList.remove('active');
      navHome.classList.remove('active');
      navRules.classList.remove('active');
      navAwards.classList.remove('active');
      navSupport.classList.remove('active');
      if (section === 'main') {
        mainSection.classList.add('active');
        navHome.classList.add('active');
      } else if (section === 'rules') {
        rulesSection.classList.add('active');
        navRules.classList.add('active');
      } else if (section === 'awards') {
        awardsSection.classList.add('active');
        navAwards.classList.add('active');
      } else if (section === 'support') {
        supportSection.classList.add('active');
        navSupport.classList.add('active');
      }
    }

    avatar.addEventListener("click", () => {
      profilePopup.classList.toggle("active");
      langPopup.classList.remove("active");
      if (!localStorage.getItem('profileSaved')) {
        showRegisterState();
      } else {
        showPlayerProfile();
      }
    });

    langBtn.addEventListener("click", () => {
      langPopup.classList.toggle("active");
      profilePopup.classList.remove("active");
    });

    langOptions.forEach(btn => {
      btn.addEventListener("click", () => {
        const lang = btn.dataset.lang;
        currentLang = lang;
        applyTranslations(lang);
      });
    });

    function showRegisterState() {
      registerBtn.style.display = "block";
      profileForm.style.display = "none";
      playerProfile.style.display = "none";
      createTeamBtn.style.display = "none";
      successMsg.style.display = "none";
    }

    function showPlayerProfile() {
      registerBtn.style.display = "none";
      profileForm.style.display = "none";
      playerProfile.style.display = "block";
      createTeamBtn.style.display = "block";
      successMsg.style.display = "block";
      profileNick.textContent = localStorage.getItem('profileNick') || "";
      profileId.textContent = localStorage.getItem('profileId') || "";
      profileTg.textContent = localStorage.getItem('profileTg') || "";
    }

    registerBtn.addEventListener("click", () => {
      registerBtn.style.display = "none";
      profileForm.style.display = "flex";
      playerProfile.style.display = "none";
      createTeamBtn.style.display = "none";
      successMsg.style.display = "none";
      if (tg.initDataUnsafe?.user) {
        const user = tg.initDataUnsafe.user;
        tgUserInput.value = user.username
          ? "@" + user.username
          : (user.first_name || "") + " " + (user.last_name || "");
      } else {
        tgUserInput.value = "";
      }
    });

    profileForm.addEventListener("submit", function(e) {
      e.preventDefault();
      localStorage.setItem('profileSaved', '1');
      localStorage.setItem('profileNick', standoffNickInput.value);
      localStorage.setItem('profileId', standoffIdInput.value);
      localStorage.setItem('profileTg', tgUserInput.value);
      showPlayerProfile();
      gtag('event', 'register', {
        'event_category': 'Profile',
        'event_label': standoffNickInput.value
      });
    });

    createTeamBtn.addEventListener("click", () => {
      alert("Функція створення команди у розробці!");
      gtag('event', 'create_team', {
        'event_category': 'Team'
      });
    });

    window.addEventListener("DOMContentLoaded", () => {
      applyTranslations(currentLang);
      if (localStorage.getItem('profileSaved')) {
        showPlayerProfile();
      } else {
        showRegisterState();
      }
      showSection('main');
    });

    document.addEventListener("click", function(e) {
      if (!profilePopup.contains(e.target) && e.target !== avatar) {
        profilePopup.classList.remove("active");
      }
      if (!langPopup.contains(e.target) && e.target !== langBtn) {
        langPopup.classList.remove("active");
      }
    });
  </script>
</body>
</html>
